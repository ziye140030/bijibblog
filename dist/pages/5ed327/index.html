<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginxé…ç½®æ•™ç¨‹ | å°æ–°è¿ç»´</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <link rel="alternate" type="application/rss+xml" href="https://blog.zzppjj.top/rss.xml" title="å°æ–°è¿ç»´ RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://blog.zzppjj.top/feed.atom" title="å°æ–°è¿ç»´ Atom Feed">
    <link rel="alternate" type="application/json" href="https://blog.zzppjj.top/feed.json" title="å°æ–°è¿ç»´ JSON Feed">
    <meta name="description" content="](http://nginx.org/)">
    <meta name="image" content="https://dictator.oss-cn-hongkong.aliyuncs.com/hexo/title/nginx.svg">
    <meta name="twitter:title" content="nginxé…ç½®æ•™ç¨‹">
    <meta name="twitter:description" content="](http://nginx.org/)">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://dictator.oss-cn-hongkong.aliyuncs.com/hexo/title/nginx.svg">
    <meta name="twitter:url" content="https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.nginx/01.nginx%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="nginxé…ç½®æ•™ç¨‹">
    <meta property="og:description" content="](http://nginx.org/)">
    <meta property="og:image" content="https://dictator.oss-cn-hongkong.aliyuncs.com/hexo/title/nginx.svg">
    <meta property="og:url" content="https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.nginx/01.nginx%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html">
    <meta property="og:site_name" content="zpj">
    <meta property="article:published_time" content="2022-12-09T20:48:36.000Z">
    <meta property="article:tag" content="nginx">
    <meta itemprop="name" content="nginxé…ç½®æ•™ç¨‹">
    <meta itemprop="description" content="](http://nginx.org/)">
    <meta itemprop="image" content="https://dictator.oss-cn-hongkong.aliyuncs.com/hexo/title/nginx.svg">
    <meta name="keywords" content="åˆ†äº«ç”Ÿæ´»,åˆ†äº«æŠ€æœ¯,,jenkins,ansible,k8s,ç›‘æ§">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.f1d706f3.css" as="style"><link rel="preload" href="/assets/js/app.47f0cd8e.js" as="script"><link rel="preload" href="/assets/js/2.5530ac35.js" as="script"><link rel="preload" href="/assets/js/90.6088167d.js" as="script"><link rel="preload" href="/assets/js/7.6ac946b2.js" as="script"><link rel="preload" href="/assets/js/4.eef75fb3.js" as="script"><link rel="prefetch" href="/assets/js/10.81f55ee2.js"><link rel="prefetch" href="/assets/js/100.d18356b6.js"><link rel="prefetch" href="/assets/js/101.ac7e4df3.js"><link rel="prefetch" href="/assets/js/102.632d60df.js"><link rel="prefetch" href="/assets/js/103.0a252168.js"><link rel="prefetch" href="/assets/js/104.9ccdb0d0.js"><link rel="prefetch" href="/assets/js/105.4f76a5e1.js"><link rel="prefetch" href="/assets/js/106.e4f311d5.js"><link rel="prefetch" href="/assets/js/107.85944381.js"><link rel="prefetch" href="/assets/js/108.3772c861.js"><link rel="prefetch" href="/assets/js/109.90e77bb7.js"><link rel="prefetch" href="/assets/js/11.0fdc92db.js"><link rel="prefetch" href="/assets/js/110.2533cf43.js"><link rel="prefetch" href="/assets/js/111.bafa5b75.js"><link rel="prefetch" href="/assets/js/112.8a23cbde.js"><link rel="prefetch" href="/assets/js/113.185cb346.js"><link rel="prefetch" href="/assets/js/114.9aaac423.js"><link rel="prefetch" href="/assets/js/115.27faf61a.js"><link rel="prefetch" href="/assets/js/116.2bef8d53.js"><link rel="prefetch" href="/assets/js/117.22604e91.js"><link rel="prefetch" href="/assets/js/118.2f1ec46b.js"><link rel="prefetch" href="/assets/js/119.0f75ba3a.js"><link rel="prefetch" href="/assets/js/12.000e424f.js"><link rel="prefetch" href="/assets/js/120.1714d17a.js"><link rel="prefetch" href="/assets/js/121.d0a65eed.js"><link rel="prefetch" href="/assets/js/122.418cc30b.js"><link rel="prefetch" href="/assets/js/123.c4121abb.js"><link rel="prefetch" href="/assets/js/124.f22556ce.js"><link rel="prefetch" href="/assets/js/125.6044ded1.js"><link rel="prefetch" href="/assets/js/126.4c1a8c13.js"><link rel="prefetch" href="/assets/js/127.adf0a45e.js"><link rel="prefetch" href="/assets/js/128.07108ccf.js"><link rel="prefetch" href="/assets/js/129.77d20ad5.js"><link rel="prefetch" href="/assets/js/13.bd2fc2ae.js"><link rel="prefetch" href="/assets/js/130.7e8f3386.js"><link rel="prefetch" href="/assets/js/131.538b632a.js"><link rel="prefetch" href="/assets/js/132.c9a04937.js"><link rel="prefetch" href="/assets/js/133.5162df80.js"><link rel="prefetch" href="/assets/js/134.5e15d059.js"><link rel="prefetch" href="/assets/js/135.1ebe9412.js"><link rel="prefetch" href="/assets/js/136.db3e1bfe.js"><link rel="prefetch" href="/assets/js/137.ff3b5a32.js"><link rel="prefetch" href="/assets/js/138.375441b7.js"><link rel="prefetch" href="/assets/js/139.b615602e.js"><link rel="prefetch" href="/assets/js/14.300d97eb.js"><link rel="prefetch" href="/assets/js/140.8303166a.js"><link rel="prefetch" href="/assets/js/141.c886b9b3.js"><link rel="prefetch" href="/assets/js/142.2d4d36c5.js"><link rel="prefetch" href="/assets/js/143.482b783c.js"><link rel="prefetch" href="/assets/js/144.5ff5f2ab.js"><link rel="prefetch" href="/assets/js/145.8da4569b.js"><link rel="prefetch" href="/assets/js/146.61829b48.js"><link rel="prefetch" href="/assets/js/147.58814577.js"><link rel="prefetch" href="/assets/js/148.65c2b04b.js"><link rel="prefetch" href="/assets/js/15.ab1987a5.js"><link rel="prefetch" href="/assets/js/16.2aa5efeb.js"><link rel="prefetch" href="/assets/js/17.4720c7f6.js"><link rel="prefetch" href="/assets/js/18.3a7c13a6.js"><link rel="prefetch" href="/assets/js/19.44e209ef.js"><link rel="prefetch" href="/assets/js/20.a85b5c3b.js"><link rel="prefetch" href="/assets/js/21.67876171.js"><link rel="prefetch" href="/assets/js/22.ca9504e6.js"><link rel="prefetch" href="/assets/js/23.ac31819f.js"><link rel="prefetch" href="/assets/js/24.73a96af0.js"><link rel="prefetch" href="/assets/js/25.0ed32651.js"><link rel="prefetch" href="/assets/js/26.f7c426dc.js"><link rel="prefetch" href="/assets/js/27.c4e513b2.js"><link rel="prefetch" href="/assets/js/28.5f1b77f4.js"><link rel="prefetch" href="/assets/js/29.34c6a6a4.js"><link rel="prefetch" href="/assets/js/3.0352ef92.js"><link rel="prefetch" href="/assets/js/30.94db5351.js"><link rel="prefetch" href="/assets/js/31.7b8150a6.js"><link rel="prefetch" href="/assets/js/32.d6153d11.js"><link rel="prefetch" href="/assets/js/33.b84a95ab.js"><link rel="prefetch" href="/assets/js/34.55db642d.js"><link rel="prefetch" href="/assets/js/35.2ed1c9d5.js"><link rel="prefetch" href="/assets/js/36.0fe018bf.js"><link rel="prefetch" href="/assets/js/37.80d143d1.js"><link rel="prefetch" href="/assets/js/38.976712a7.js"><link rel="prefetch" href="/assets/js/39.6690f68d.js"><link rel="prefetch" href="/assets/js/40.77764e63.js"><link rel="prefetch" href="/assets/js/41.e4ca8e43.js"><link rel="prefetch" href="/assets/js/42.a1a4d2fc.js"><link rel="prefetch" href="/assets/js/43.198e2acd.js"><link rel="prefetch" href="/assets/js/44.4849b174.js"><link rel="prefetch" href="/assets/js/45.302e0dc1.js"><link rel="prefetch" href="/assets/js/46.9ae516ca.js"><link rel="prefetch" href="/assets/js/47.55630297.js"><link rel="prefetch" href="/assets/js/48.e9414fc8.js"><link rel="prefetch" href="/assets/js/49.22046e51.js"><link rel="prefetch" href="/assets/js/5.ff0128d3.js"><link rel="prefetch" href="/assets/js/50.006b5133.js"><link rel="prefetch" href="/assets/js/51.767c15f6.js"><link rel="prefetch" href="/assets/js/52.bc5cf8a3.js"><link rel="prefetch" href="/assets/js/53.0086d1ba.js"><link rel="prefetch" href="/assets/js/54.ab437c97.js"><link rel="prefetch" href="/assets/js/55.f8ab2ed7.js"><link rel="prefetch" href="/assets/js/56.ca1c4d55.js"><link rel="prefetch" href="/assets/js/57.60113c99.js"><link rel="prefetch" href="/assets/js/58.484b820d.js"><link rel="prefetch" href="/assets/js/59.42669ea7.js"><link rel="prefetch" href="/assets/js/6.9233c8ba.js"><link rel="prefetch" href="/assets/js/60.32830bd6.js"><link rel="prefetch" href="/assets/js/61.c294b35e.js"><link rel="prefetch" href="/assets/js/62.3847c350.js"><link rel="prefetch" href="/assets/js/63.688d8596.js"><link rel="prefetch" href="/assets/js/64.741a9d90.js"><link rel="prefetch" href="/assets/js/65.ed57c0f1.js"><link rel="prefetch" href="/assets/js/66.9405b55d.js"><link rel="prefetch" href="/assets/js/67.1d7172c8.js"><link rel="prefetch" href="/assets/js/68.d0ad00f8.js"><link rel="prefetch" href="/assets/js/69.db06d380.js"><link rel="prefetch" href="/assets/js/70.57aba264.js"><link rel="prefetch" href="/assets/js/71.a6dd0c4b.js"><link rel="prefetch" href="/assets/js/72.f3a83244.js"><link rel="prefetch" href="/assets/js/73.355c1bbf.js"><link rel="prefetch" href="/assets/js/74.349f773d.js"><link rel="prefetch" href="/assets/js/75.cc8bf69e.js"><link rel="prefetch" href="/assets/js/76.ac102bf3.js"><link rel="prefetch" href="/assets/js/77.d5c0c561.js"><link rel="prefetch" href="/assets/js/78.311da636.js"><link rel="prefetch" href="/assets/js/79.5c065bda.js"><link rel="prefetch" href="/assets/js/8.6ac87516.js"><link rel="prefetch" href="/assets/js/80.5d12ef73.js"><link rel="prefetch" href="/assets/js/81.d2a54a28.js"><link rel="prefetch" href="/assets/js/82.a31f7942.js"><link rel="prefetch" href="/assets/js/83.b7215433.js"><link rel="prefetch" href="/assets/js/84.dc5bc5f6.js"><link rel="prefetch" href="/assets/js/85.bdb4adfa.js"><link rel="prefetch" href="/assets/js/86.e06aba32.js"><link rel="prefetch" href="/assets/js/87.b69cbc30.js"><link rel="prefetch" href="/assets/js/88.38f8c611.js"><link rel="prefetch" href="/assets/js/89.e90e0d13.js"><link rel="prefetch" href="/assets/js/9.d0ee1374.js"><link rel="prefetch" href="/assets/js/91.8075e02f.js"><link rel="prefetch" href="/assets/js/92.12fca424.js"><link rel="prefetch" href="/assets/js/93.b15267bd.js"><link rel="prefetch" href="/assets/js/94.1942eff5.js"><link rel="prefetch" href="/assets/js/95.7f440415.js"><link rel="prefetch" href="/assets/js/96.41c38b39.js"><link rel="prefetch" href="/assets/js/97.af8dbaff.js"><link rel="prefetch" href="/assets/js/98.200f2cf6.js"><link rel="prefetch" href="/assets/js/99.a2d5af04.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f1d706f3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://i.imgtg.com/2023/03/14/fEWaK.jpg" alt="å°æ–°è¿ç»´" class="logo"> <span class="site-name can-hide">å°æ–°è¿ç»´</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¿ç»´" class="dropdown-title"><a href="/ops/" class="link-title">è¿ç»´</a> <span class="title" style="display:none;">è¿ç»´</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/windows/" class="nav-link">windows</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link">ä¸­é—´ä»¶</a></li><li class="dropdown-item"><!----> <a href="/monitor/" class="nav-link">ç›‘æ§</a></li><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">ç½‘ç»œ</a></li><li class="dropdown-item"><!----> <a href="/storage/" class="nav-link">å­˜å‚¨</a></li><li class="dropdown-item"><!----> <a href="/safety/" class="nav-link">å®‰å…¨</a></li><li class="dropdown-item"><!----> <a href="/firewalld/" class="nav-link">é˜²ç«å¢™</a></li><li class="dropdown-item"><!----> <a href="/db/" class="nav-link">æ•°æ®åº“</a></li><li class="dropdown-item"><!----> <a href="/sys/" class="nav-link">ç³»ç»Ÿ</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">docker</a></li><li class="dropdown-item"><!----> <a href="/tool/" class="nav-link">è¿ç»´å·¥å…·</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">other</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸“é¢˜" class="dropdown-title"><a href="/topic/" class="link-title">ä¸“é¢˜</a> <span class="title" style="display:none;">ä¸“é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/elk/" class="nav-link">elk</a></li><li class="dropdown-item"><!----> <a href="/k8s/" class="nav-link">k8s</a></li><li class="dropdown-item"><!----> <a href="/ansible/" class="nav-link">ansible</a></li><li class="dropdown-item"><!----> <a href="/jenkins/" class="nav-link">Jenkins</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç”Ÿæ´»" class="dropdown-title"><a href="/life/" class="link-title">ç”Ÿæ´»</a> <span class="title" style="display:none;">ç”Ÿæ´»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/suibi/" class="nav-link">éšç¬”</a></li><li class="dropdown-item"><!----> <a href="/mianshi/" class="nav-link">é¢è¯•</a></li><li class="dropdown-item"><!----> <a href="/gongju/" class="nav-link">å·¥å…·</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¼–ç¨‹" class="dropdown-title"><a href="/code/" class="link-title">ç¼–ç¨‹</a> <span class="title" style="display:none;">ç¼–ç¨‹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/shell/" class="nav-link">Shell</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><a href="/friends/" class="nav-link">å‹é“¾</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/categories/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://imgtg.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å›¾åºŠ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¼€å¾€
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/ziye140030" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://i.imgtg.com/2023/03/14/fE4o1.jpg"> <div class="blogger-info"><h3>å°æ–°è¿ç»´</h3> <span>å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Š</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¿ç»´" class="dropdown-title"><a href="/ops/" class="link-title">è¿ç»´</a> <span class="title" style="display:none;">è¿ç»´</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/windows/" class="nav-link">windows</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link">ä¸­é—´ä»¶</a></li><li class="dropdown-item"><!----> <a href="/monitor/" class="nav-link">ç›‘æ§</a></li><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">ç½‘ç»œ</a></li><li class="dropdown-item"><!----> <a href="/storage/" class="nav-link">å­˜å‚¨</a></li><li class="dropdown-item"><!----> <a href="/safety/" class="nav-link">å®‰å…¨</a></li><li class="dropdown-item"><!----> <a href="/firewalld/" class="nav-link">é˜²ç«å¢™</a></li><li class="dropdown-item"><!----> <a href="/db/" class="nav-link">æ•°æ®åº“</a></li><li class="dropdown-item"><!----> <a href="/sys/" class="nav-link">ç³»ç»Ÿ</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">docker</a></li><li class="dropdown-item"><!----> <a href="/tool/" class="nav-link">è¿ç»´å·¥å…·</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">other</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸“é¢˜" class="dropdown-title"><a href="/topic/" class="link-title">ä¸“é¢˜</a> <span class="title" style="display:none;">ä¸“é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/elk/" class="nav-link">elk</a></li><li class="dropdown-item"><!----> <a href="/k8s/" class="nav-link">k8s</a></li><li class="dropdown-item"><!----> <a href="/ansible/" class="nav-link">ansible</a></li><li class="dropdown-item"><!----> <a href="/jenkins/" class="nav-link">Jenkins</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç”Ÿæ´»" class="dropdown-title"><a href="/life/" class="link-title">ç”Ÿæ´»</a> <span class="title" style="display:none;">ç”Ÿæ´»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/suibi/" class="nav-link">éšç¬”</a></li><li class="dropdown-item"><!----> <a href="/mianshi/" class="nav-link">é¢è¯•</a></li><li class="dropdown-item"><!----> <a href="/gongju/" class="nav-link">å·¥å…·</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¼–ç¨‹" class="dropdown-title"><a href="/code/" class="link-title">ç¼–ç¨‹</a> <span class="title" style="display:none;">ç¼–ç¨‹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/shell/" class="nav-link">Shell</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><a href="/friends/" class="nav-link">å‹é“¾</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/categories/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://imgtg.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å›¾åºŠ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¼€å¾€
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/ziye140030" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>windows</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ä¸­é—´ä»¶</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>nginx</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/5ed327/" aria-current="page" class="active sidebar-link">nginxé…ç½®æ•™ç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#å®‰è£…" class="sidebar-link">å®‰è£…</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#å®‰è£…ä¾èµ–" class="sidebar-link">å®‰è£…ä¾èµ–</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#ä¸‹è½½" class="sidebar-link">ä¸‹è½½</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#ç¼–è¯‘å®‰è£…" class="sidebar-link">ç¼–è¯‘å®‰è£…</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#nginxæµ‹è¯•" class="sidebar-link">nginxæµ‹è¯•</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#è®¾ç½®å…¨å±€nginxå‘½ä»¤" class="sidebar-link">è®¾ç½®å…¨å±€nginxå‘½ä»¤</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#mac-å®‰è£…" class="sidebar-link">Mac å®‰è£…</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#å®‰è£…nginx" class="sidebar-link">å®‰è£…nginx</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#å¯åŠ¨æœåŠ¡" class="sidebar-link">å¯åŠ¨æœåŠ¡</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#å¼€æœºè‡ªå¯åŠ¨" class="sidebar-link">å¼€æœºè‡ªå¯åŠ¨</a></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#è¿ç»´" class="sidebar-link">è¿ç»´</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#æœåŠ¡ç®¡ç†" class="sidebar-link">æœåŠ¡ç®¡ç†</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³" class="sidebar-link">é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#nginxå¸è½½" class="sidebar-link">nginxå¸è½½</a></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#å‚æ•°è¯´æ˜" class="sidebar-link">å‚æ•°è¯´æ˜</a></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#é…ç½®" class="sidebar-link">é…ç½®</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#å¸¸ç”¨æ­£åˆ™" class="sidebar-link">å¸¸ç”¨æ­£åˆ™</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#å…¨å±€å˜é‡" class="sidebar-link">å…¨å±€å˜é‡</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#ç¬¦å·å‚è€ƒ" class="sidebar-link">ç¬¦å·å‚è€ƒ</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#é…ç½®æ–‡ä»¶" class="sidebar-link">é…ç½®æ–‡ä»¶</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#å†…ç½®é¢„å®šä¹‰å˜é‡" class="sidebar-link">å†…ç½®é¢„å®šä¹‰å˜é‡</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#åå‘ä»£ç†" class="sidebar-link">åå‘ä»£ç†</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#è´Ÿè½½å‡è¡¡" class="sidebar-link">è´Ÿè½½å‡è¡¡</a></li><li class="sidebar-sub-header level4"><a href="/pages/5ed327/#rr" class="sidebar-link">RR</a></li><li class="sidebar-sub-header level4"><a href="/pages/5ed327/#æƒé‡" class="sidebar-link">æƒé‡</a></li><li class="sidebar-sub-header level4"><a href="/pages/5ed327/#ip-hash" class="sidebar-link">ip_hash</a></li><li class="sidebar-sub-header level4"><a href="/pages/5ed327/#fair" class="sidebar-link">fair</a></li><li class="sidebar-sub-header level4"><a href="/pages/5ed327/#url-hash" class="sidebar-link">url_hash</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#å±è”½ip" class="sidebar-link">å±è”½ip</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•" class="sidebar-link">ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•</a></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#é‡å®šå‘" class="sidebar-link">é‡å®šå‘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#é‡å®šå‘æ•´ä¸ªç½‘ç«™" class="sidebar-link">é‡å®šå‘æ•´ä¸ªç½‘ç«™</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#é‡å®šå‘å•é¡µ" class="sidebar-link">é‡å®šå‘å•é¡µ</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#é‡å®šå‘æ•´ä¸ªå­è·¯å¾„" class="sidebar-link">é‡å®šå‘æ•´ä¸ªå­è·¯å¾„</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#æ€§èƒ½" class="sidebar-link">æ€§èƒ½</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#å†…å®¹ç¼“å­˜" class="sidebar-link">å†…å®¹ç¼“å­˜</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#gzipå‹ç¼©" class="sidebar-link">Gzipå‹ç¼©</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#æ‰“å¼€æ–‡ä»¶ç¼“å­˜" class="sidebar-link">æ‰“å¼€æ–‡ä»¶ç¼“å­˜</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#sslç¼“å­˜" class="sidebar-link">SSLç¼“å­˜</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#ä¸Šæ¸¸keepalive" class="sidebar-link">ä¸Šæ¸¸Keepalive</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#ç›‘æ§" class="sidebar-link">ç›‘æ§</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#å¸¸è§ä½¿ç”¨åœºæ™¯" class="sidebar-link">å¸¸è§ä½¿ç”¨åœºæ™¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#è·¨åŸŸé—®é¢˜" class="sidebar-link">è·¨åŸŸé—®é¢˜</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢" class="sidebar-link">è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#ä»£ç†è½¬å‘" class="sidebar-link">ä»£ç†è½¬å‘</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#ç›‘æ§çŠ¶æ€ä¿¡æ¯" class="sidebar-link">ç›‘æ§çŠ¶æ€ä¿¡æ¯</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢" class="sidebar-link">ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#sslé…ç½®" class="sidebar-link">sslé…ç½®</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https" class="sidebar-link">å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº" class="sidebar-link">ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®" class="sidebar-link">è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#çˆ¬è™«è¿‡æ»¤" class="sidebar-link">çˆ¬è™«è¿‡æ»¤</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#é˜²ç›—é“¾" class="sidebar-link">é˜²ç›—é“¾</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#è™šæ‹Ÿç›®å½•é…ç½®" class="sidebar-link">è™šæ‹Ÿç›®å½•é…ç½®</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#é˜²ç›—å›¾é…ç½®" class="sidebar-link">é˜²ç›—å›¾é…ç½®</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#å±è”½-gitç­‰æ–‡ä»¶" class="sidebar-link">å±è”½.gitç­‰æ–‡ä»¶</a></li><li class="sidebar-sub-header level3"><a href="/pages/5ed327/#åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®" class="sidebar-link">åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#é”™è¯¯é—®é¢˜" class="sidebar-link">é”™è¯¯é—®é¢˜</a></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#nginx-æ¨¡å—" class="sidebar-link">Nginx æ¨¡å—</a></li><li class="sidebar-sub-header level2"><a href="/pages/5ed327/#ç²¾å“æ–‡ç« å‚è€ƒ" class="sidebar-link">ç²¾å“æ–‡ç« å‚è€ƒ</a></li></ul></li><li><a href="/pages/df9ea8/" class="sidebar-link">nginxå¸¸ç”¨é…ç½®</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>kafka</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/pages/fd6cf8/" class="sidebar-link">apolloéƒ¨ç½²</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç½‘ç»œ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å®‰å…¨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å­˜å‚¨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é˜²ç«å¢™</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ•°æ®åº“</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç³»ç»Ÿ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>other</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç›‘æ§</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/ops/#è¿ç»´" data-v-06225672>è¿ç»´</a></li><li data-v-06225672><a href="/ops/#ä¸­é—´ä»¶" data-v-06225672>ä¸­é—´ä»¶</a></li><li data-v-06225672><a href="/ops/#nginx" data-v-06225672>nginx</a></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/ziye140030" target="_blank" title="ä½œè€…" class="beLink" data-v-06225672>å°æ–°è¿ç»´</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-12-09</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">nginxé…ç½®æ•™ç¨‹<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="nginxé…ç½®æ•™ç¨‹"><a href="#nginxé…ç½®æ•™ç¨‹" class="header-anchor">#</a> Nginxé…ç½®æ•™ç¨‹</h1> <p><a href="http://nginx.org/" target="_blank" rel="noopener noreferrer"><img src="https://dictator.oss-cn-hongkong.aliyuncs.com/hexo/title/nginx.svg" alt="img"> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Nginx æ˜¯ä¸€æ¬¾é¢å‘æ€§èƒ½è®¾è®¡çš„ HTTP æœåŠ¡å™¨ï¼Œèƒ½åå‘ä»£ç† HTTPï¼ŒHTTPS å’Œé‚®ä»¶ç›¸å…³(SMTPï¼ŒPOP3ï¼ŒIMAP)çš„åè®®é“¾æ¥ã€‚å¹¶ä¸”æä¾›äº†è´Ÿè½½å‡è¡¡ä»¥åŠ HTTP ç¼“å­˜ã€‚å®ƒçš„è®¾è®¡å……åˆ†ä½¿ç”¨å¼‚æ­¥äº‹ä»¶æ¨¡å‹ï¼Œå‰Šå‡ä¸Šä¸‹æ–‡è°ƒåº¦çš„å¼€é”€ï¼Œæé«˜æœåŠ¡å™¨å¹¶å‘èƒ½åŠ›ã€‚é‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼Œæä¾›äº†ä¸°å¯Œæ¨¡å—çš„ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚</p> <p>æ‰€ä»¥å…³äº Nginxï¼Œæœ‰è¿™äº›æ ‡ç­¾ï¼šã€Œå¼‚æ­¥ã€ã€Œäº‹ä»¶ã€ã€Œæ¨¡å—åŒ–ã€ã€Œé«˜æ€§èƒ½ã€ã€Œé«˜å¹¶å‘ã€ã€Œåå‘ä»£ç†ã€ã€Œè´Ÿè½½å‡è¡¡ã€</p> <p>Linuxç³»ç»Ÿï¼š<code>Centos 7 x64</code>
Nginxç‰ˆæœ¬ï¼š<code>1.11.5</code></p> <h2 id="å®‰è£…"><a href="#å®‰è£…" class="header-anchor">#</a> å®‰è£…</h2> <h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="header-anchor">#</a> å®‰è£…ä¾èµ–</h3> <blockquote><p>prce(é‡å®šå‘æ”¯æŒ)å’Œopenssl(httpsæ”¯æŒï¼Œå¦‚æœä¸éœ€è¦httpså¯ä»¥ä¸å®‰è£…ã€‚)</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶yum install -y pcre-devel 
yum -y install gcc make gcc-c++ wget
yum -y install openssl openssl-devel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>CentOS 6.5 æˆ‘å®‰è£…çš„æ—¶å€™æ˜¯é€‰æ‹©çš„â€œåŸºæœ¬æœåŠ¡å™¨â€ï¼Œé»˜è®¤è¿™ä¸¤ä¸ªåŒ…éƒ½æ²¡å®‰è£…å…¨ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªéƒ½è¿è¡Œå®‰è£…å³å¯ã€‚</p> <h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="header-anchor">#</a> ä¸‹è½½</h3> <p><a href="http://nginx.org/download/" target="_blank" rel="noopener noreferrer">nginxçš„æ‰€æœ‰ç‰ˆæœ¬åœ¨è¿™é‡Œ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶wget http://nginx.org/download/nginx-1.13.3.tar.gz
wget http://nginx.org/download/nginx-1.13.7.tar.gz

# å¦‚æœæ²¡æœ‰å®‰è£…wget
# ä¸‹è½½å·²ç¼–è¯‘ç‰ˆæœ¬
$ yum install wget

# è§£å‹å‹ç¼©åŒ…
tar zxf nginx-1.13.3.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="header-anchor">#</a> ç¼–è¯‘å®‰è£…</h3> <p>ç„¶åè¿›å…¥ç›®å½•ç¼–è¯‘å®‰è£…ï¼Œ<a href="https://www.viayc.com/2019/03/13/Nginx%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B/#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">configureå‚æ•°è¯´æ˜<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶cd nginx-1.11.5
./configure

....
Configuration summary
  + using system PCRE library
  + OpenSSL library is not used
  + using system zlib library

  nginx path prefix: &quot;/usr/local/nginx&quot;
  nginx binary file: &quot;/usr/local/nginx/sbin/nginx&quot;
  nginx modules path: &quot;/usr/local/nginx/modules&quot;
  nginx configuration prefix: &quot;/usr/local/nginx/conf&quot;
  nginx configuration file: &quot;/usr/local/nginx/conf/nginx.conf&quot;
  nginx pid file: &quot;/usr/local/nginx/logs/nginx.pid&quot;
  nginx error log file: &quot;/usr/local/nginx/logs/error.log&quot;
  nginx http access log file: &quot;/usr/local/nginx/logs/access.log&quot;
  nginx http client request body temporary files: &quot;client_body_temp&quot;
  nginx http proxy temporary files: &quot;proxy_temp&quot;
  nginx http fastcgi temporary files: &quot;fastcgi_temp&quot;
  nginx http uwsgi temporary files: &quot;uwsgi_temp&quot;
  nginx http scgi temporary files: &quot;scgi_temp&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>å®‰è£…æŠ¥é”™è¯¯çš„è¯æ¯”å¦‚ï¼šâ€œC compiler cc is not foundâ€ï¼Œè¿™ä¸ªå°±æ˜¯ç¼ºå°‘ç¼–è¯‘ç¯å¢ƒï¼Œå®‰è£…ä¸€ä¸‹å°±å¯ä»¥äº† <strong>yum -y install gcc make gcc-c++ openssl-devel</strong></p> <p>å¦‚æœæ²¡æœ‰errorä¿¡æ¯ï¼Œå°±å¯ä»¥æ‰§è¡Œä¸‹è¾¹çš„å®‰è£…äº†ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶make
make install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="nginxæµ‹è¯•"><a href="#nginxæµ‹è¯•" class="header-anchor">#</a> nginxæµ‹è¯•</h3> <p>è¿è¡Œä¸‹é¢å‘½ä»¤ä¼šå‡ºç°ä¸¤ä¸ªç»“æœï¼Œä¸€èˆ¬æƒ…å†µnginxä¼šå®‰è£…åœ¨<code>/usr/local/nginx</code>ç›®å½•ä¸­</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶cd /usr/local/nginx/sbin/
./nginx -t

# nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
# nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="è®¾ç½®å…¨å±€nginxå‘½ä»¤"><a href="#è®¾ç½®å…¨å±€nginxå‘½ä»¤" class="header-anchor">#</a> è®¾ç½®å…¨å±€nginxå‘½ä»¤</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶vi ~/.bash_profile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å°†ä¸‹é¢å†…å®¹æ·»åŠ åˆ° <code>~/.bash_profile</code> æ–‡ä»¶ä¸­</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶PATH=$PATH:$HOME/bin:/usr/local/nginx/sbin/
export PATH
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿è¡Œå‘½ä»¤ <strong><code>source ~/.bash_profile</code></strong> è®©é…ç½®ç«‹å³ç”Ÿæ•ˆã€‚ä½ å°±å¯ä»¥å…¨å±€è¿è¡Œ <code>nginx</code> å‘½ä»¤äº†ã€‚</p> <h2 id="mac-å®‰è£…"><a href="#mac-å®‰è£…" class="header-anchor">#</a> Mac å®‰è£…</h2> <p>Mac OSX å®‰è£…ç‰¹åˆ«ç®€å•ï¼Œé¦–å…ˆä½ éœ€è¦å®‰è£… <a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">Brew<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œ é€šè¿‡ <code>brew</code> å¿«é€Ÿå®‰è£… <code>nginx</code>ã€‚</p> <h3 id="å®‰è£…nginx"><a href="#å®‰è£…nginx" class="header-anchor">#</a> å®‰è£…nginx</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶brew install nginx
# Updating Homebrew...
# ==&gt; Auto-updated Homebrew!
# Updated 2 taps (homebrew/core, homebrew/cask).
# ==&gt; Updated Formulae
# ==&gt; Installing dependencies for nginx: openssl, pcre
# ==&gt; Installing nginx dependency: openssl
# ==&gt; Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2o_1.high_sierra.bottle.tar.gz
# ######################################################################## 100.0%
# ==&gt; Pouring openssl-1.0.2o_1.high_sierra.bottle.tar.gz
# ==&gt; Caveats
# A CA file has been bootstrapped using certificates from the SystemRoots
# keychain. To add additional certificates (e.g. the certificates added in
# the System keychain), place .pem files in
#   /usr/local/etc/openssl/certs
# 
# and run
#   /usr/local/opt/openssl/bin/c_rehash
# 
# This formula is keg-only, which means it was not symlinked into /usr/local,
# because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.
# 
# If you need to have this software first in your PATH run:
#   echo 'export PATH=&quot;/usr/local/opt/openssl/bin:$PATH&quot;' &gt;&gt; ~/.zshrc
# 
# For compilers to find this software you may need to set:
#     LDFLAGS:  -L/usr/local/opt/openssl/lib
#     CPPFLAGS: -I/usr/local/opt/openssl/include
# For pkg-config to find this software you may need to set:
#     PKG_CONFIG_PATH: /usr/local/opt/openssl/lib/pkgconfig
# 
# ==&gt; Summary
# ğŸº  /usr/local/Cellar/openssl/1.0.2o_1: 1,791 files, 12.3MB
# ==&gt; Installing nginx dependency: pcre
# ==&gt; Downloading https://homebrew.bintray.com/bottles/pcre-8.42.high_sierra.bottle.tar.gz
# ######################################################################## 100.0%
# ==&gt; Pouring pcre-8.42.high_sierra.bottle.tar.gz
# ğŸº  /usr/local/Cellar/pcre/8.42: 204 files, 5.3MB
# ==&gt; Installing nginx
# ==&gt; Downloading https://homebrew.bintray.com/bottles/nginx-1.13.12.high_sierra.bottle.tar.gz
# ######################################################################## 100.0%
# ==&gt; Pouring nginx-1.13.12.high_sierra.bottle.tar.gz
# ==&gt; Caveats
# Docroot is: /usr/local/var/www
# 
# The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that
# nginx can run without sudo.
# 
# nginx will load all files in /usr/local/etc/nginx/servers/.
# 
# To have launchd start nginx now and restart at login:
#   brew services start nginx
# Or, if you don't wacd /usr/local/Cellar/nginx/1.13.12/n just run:
# cd /usr/local/Cellar/nginx/1.13.12/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="header-anchor">#</a> å¯åŠ¨æœåŠ¡</h3> <p>æ³¨æ„é»˜è®¤ç«¯å£ä¸æ˜¯ <code>8080</code> æŸ¥çœ‹ç¡®è®¤ç«¯å£æ˜¯å¦è¢«å ç”¨ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶brew services start nginx
# http://localhost:8080/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="å¼€æœºè‡ªå¯åŠ¨"><a href="#å¼€æœºè‡ªå¯åŠ¨" class="header-anchor">#</a> å¼€æœºè‡ªå¯åŠ¨</h2> <p><strong>å¼€æœºè‡ªå¯åŠ¨æ–¹æ³•ä¸€ï¼š</strong></p> <p>ç¼–è¾‘ <strong>vi /lib/systemd/system/nginx.service</strong> æ–‡ä»¶ï¼Œæ²¡æœ‰åˆ›å»ºä¸€ä¸ª <strong>touch nginx.service</strong> ç„¶åå°†å¦‚ä¸‹å†…å®¹æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œä¿®æ”¹åï¼Œæ·»åŠ åˆ°nginx.serviceæ–‡ä»¶ä¸­ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶[Unit]
Description=nginx
After=network.target remote-fs.target nss-lookup.target

[Service]

Type=forking
PIDFile=/var/run/nginx.pid
ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf
ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/bin/kill -s QUIT $MAINPID
PrivateTmp=true

[Install]
WantedBy=multi-user.target
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li><code>[Unit]</code>:æœåŠ¡çš„è¯´æ˜</li> <li><code>Description</code>:æè¿°æœåŠ¡</li> <li><code>After</code>:æè¿°æœåŠ¡ç±»åˆ«</li> <li><code>[Service]</code>æœåŠ¡è¿è¡Œå‚æ•°çš„è®¾ç½®</li> <li><code>Type=forking</code>æ˜¯åå°è¿è¡Œçš„å½¢å¼</li> <li><code>ExecStart</code>ä¸ºæœåŠ¡çš„å…·ä½“è¿è¡Œå‘½ä»¤</li> <li><code>ExecReload</code>ä¸ºé‡å¯å‘½ä»¤</li> <li><code>ExecStop</code>ä¸ºåœæ­¢å‘½ä»¤</li> <li><code>PrivateTmp=True</code>è¡¨ç¤ºç»™æœåŠ¡åˆ†é…ç‹¬ç«‹çš„ä¸´æ—¶ç©ºé—´</li></ul> <p>æ³¨æ„ï¼š<code>[Service]</code>çš„å¯åŠ¨ã€é‡å¯ã€åœæ­¢å‘½ä»¤å…¨éƒ¨è¦æ±‚ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚</p> <p><code>[Install]</code>è¿è¡Œçº§åˆ«ä¸‹æœåŠ¡å®‰è£…çš„ç›¸å…³è®¾ç½®ï¼Œå¯è®¾ç½®ä¸ºå¤šç”¨æˆ·ï¼Œå³ç³»ç»Ÿè¿è¡Œçº§åˆ«ä¸º<code>3</code>ã€‚</p> <p>ä¿å­˜é€€å‡ºã€‚</p> <p>è®¾ç½®å¼€æœºå¯åŠ¨ï¼Œä½¿é…ç½®ç”Ÿæ•ˆï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶# å¯åŠ¨nginxæœåŠ¡
systemctl start nginx.service
# åœæ­¢å¼€æœºè‡ªå¯åŠ¨
systemctl disable nginx.service
# æŸ¥çœ‹æœåŠ¡å½“å‰çŠ¶æ€
systemctl status nginx.service
# æŸ¥çœ‹æ‰€æœ‰å·²å¯åŠ¨çš„æœåŠ¡
systemctl list-units --type=service
# é‡æ–°å¯åŠ¨æœåŠ¡
systemctl restart nginx.service
# è®¾ç½®å¼€æœºè‡ªå¯åŠ¨
systemctl enable nginx.service
# è¾“å‡ºä¸‹é¢å†…å®¹è¡¨ç¤ºæˆåŠŸäº†
Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.
å¤åˆ¶systemctl is-enabled servicename.service # æŸ¥è¯¢æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨
systemctl enable *.service # å¼€æœºè¿è¡ŒæœåŠ¡
systemctl disable *.service # å–æ¶ˆå¼€æœºè¿è¡Œ
systemctl start *.service # å¯åŠ¨æœåŠ¡
systemctl stop *.service # åœæ­¢æœåŠ¡
systemctl restart *.service # é‡å¯æœåŠ¡
systemctl reload *.service # é‡æ–°åŠ è½½æœåŠ¡é…ç½®æ–‡ä»¶
systemctl status *.service # æŸ¥è¯¢æœåŠ¡è¿è¡ŒçŠ¶æ€
systemctl --failed # æ˜¾ç¤ºå¯åŠ¨å¤±è´¥çš„æœåŠ¡
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>æ³¨ï¼š*ä»£è¡¨æŸä¸ªæœåŠ¡çš„åå­—ï¼Œå¦‚httpçš„æœåŠ¡åä¸ºhttpd</p> <p><strong>å¼€æœºè‡ªå¯åŠ¨æ–¹æ³•äºŒï¼š</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶vi /etc/rc.local

# åœ¨ rc.local æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢è¿™æ¡å‘½ä»¤
/usr/local/nginx/sbin/nginx start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å¦‚æœå¼€æœºåå‘ç°è‡ªå¯åŠ¨è„šæœ¬æ²¡æœ‰æ‰§è¡Œï¼Œä½ è¦å»ç¡®è®¤ä¸€ä¸‹rc.localè¿™ä¸ªæ–‡ä»¶çš„è®¿é—®æƒé™æ˜¯å¦æ˜¯å¯æ‰§è¡Œçš„ï¼Œå› ä¸ºrc.localé»˜è®¤æ˜¯ä¸å¯æ‰§è¡Œçš„ã€‚ä¿®æ”¹rc.localè®¿é—®æƒé™ï¼Œå¢åŠ å¯æ‰§è¡Œæƒé™ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶# /etc/rc.localæ˜¯/etc/rc.d/rc.localçš„è½¯è¿æ¥ï¼Œ
chmod +x /etc/rc.d/rc.local
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å®˜æ–¹è„šæœ¬ <a href="https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/" target="_blank" rel="noopener noreferrer">ed Hat NGINX Init Script<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <h2 id="è¿ç»´"><a href="#è¿ç»´" class="header-anchor">#</a> è¿ç»´</h2> <h3 id="æœåŠ¡ç®¡ç†"><a href="#æœåŠ¡ç®¡ç†" class="header-anchor">#</a> æœåŠ¡ç®¡ç†</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶# å¯åŠ¨
/usr/local/nginx/sbin/nginx

# é‡å¯
/usr/local/nginx/sbin/nginx -s reload

# å…³é—­è¿›ç¨‹
/usr/local/nginx/sbin/nginx -s stop

# å¹³æ»‘å…³é—­nginx
/usr/local/nginx/sbin/nginx -s quit

# æŸ¥çœ‹nginxçš„å®‰è£…çŠ¶æ€ï¼Œ
/usr/local/nginx/sbin/nginx -V
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>å…³é—­é˜²ç«å¢™ï¼Œæˆ–è€…æ·»åŠ é˜²ç«å¢™è§„åˆ™å°±å¯ä»¥æµ‹è¯•äº†</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶service iptables stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æˆ–è€…ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶vi /etc/sysconfig/iptables
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ·»åŠ è¿™æ ·ä¸€æ¡å¼€æ”¾80ç«¯å£çš„è§„åˆ™åä¿å­˜ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>é‡å¯æœåŠ¡å³å¯:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶service iptables restart
# å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ç›®å‰nat
iptables -t nat -L
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³"><a href="#é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³" class="header-anchor">#</a> é‡å¯æœåŠ¡é˜²ç«å¢™æŠ¥é”™è§£å†³</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶service iptables restart
# Redirecting to /bin/systemctl restart  iptables.service
# Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åœ¨CentOS 7æˆ–RHEL 7æˆ–Fedoraä¸­é˜²ç«å¢™ç”± <strong>firewalld</strong> æ¥ç®¡ç†ï¼Œå½“ç„¶ä½ å¯ä»¥è¿˜åŸä¼ ç»Ÿçš„ç®¡ç†æ–¹å¼ã€‚æˆ–åˆ™ä½¿ç”¨æ–°çš„å‘½ä»¤è¿›è¡Œç®¡ç†ã€‚
å‡å¦‚é‡‡ç”¨ä¼ ç»Ÿè¯·æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶# ä¼ ç»Ÿå‘½ä»¤
systemctl stop firewalld
systemctl mask firewalld
å¤åˆ¶# å®‰è£…å‘½ä»¤
yum install iptables-services

systemctl enable iptables 
service iptables restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="nginxå¸è½½"><a href="#nginxå¸è½½" class="header-anchor">#</a> nginxå¸è½½</h2> <p>å¦‚æœé€šè¿‡yumå®‰è£…ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶yum remove nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ç¼–è¯‘å®‰è£…ï¼Œåˆ é™¤/usr/local/nginxç›®å½•å³å¯
å¦‚æœé…ç½®äº†è‡ªå¯åŠ¨è„šæœ¬ï¼Œä¹Ÿéœ€è¦åˆ é™¤ã€‚</p> <h2 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="header-anchor">#</a> å‚æ•°è¯´æ˜</h2> <table><thead><tr><th style="text-align:left;">å‚æ•°</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">â€“prefix=<code>&lt;path&gt;</code></td> <td style="text-align:left;">Nginxå®‰è£…è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º /usr/local/nginxã€‚</td></tr> <tr><td style="text-align:left;">â€“sbin-path=<code>&lt;path&gt;</code></td> <td style="text-align:left;">Nginxå¯æ‰§è¡Œæ–‡ä»¶å®‰è£…è·¯å¾„ã€‚åªèƒ½å®‰è£…æ—¶æŒ‡å®šï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º<code>&lt;prefix&gt;</code>/sbin/nginxã€‚</td></tr> <tr><td style="text-align:left;">â€“conf-path=<code>&lt;path&gt;</code></td> <td style="text-align:left;">åœ¨æ²¡æœ‰ç»™å®š-cé€‰é¡¹ä¸‹é»˜è®¤çš„nginx.confçš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º<code>&lt;prefix&gt;</code>/conf/nginx.confã€‚</td></tr> <tr><td style="text-align:left;">â€“pid-path=<code>&lt;path&gt;</code></td> <td style="text-align:left;">åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®špidæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginx.pidçš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º <code>&lt;prefix&gt;</code>/logs/nginx.pidã€‚</td></tr> <tr><td style="text-align:left;">â€“lock-path=<code>&lt;path&gt;</code></td> <td style="text-align:left;">nginx.lockæ–‡ä»¶çš„è·¯å¾„ã€‚</td></tr> <tr><td style="text-align:left;">â€“error-log-path=<code>&lt;path&gt;</code></td> <td style="text-align:left;">åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šerror_logæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„é”™è¯¯æ—¥å¿—çš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º <code>&lt;prefix&gt;</code>/- logs/error.logã€‚</td></tr> <tr><td style="text-align:left;">â€“http-log-path=<code>&lt;path&gt;</code></td> <td style="text-align:left;">åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šaccess_logæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„è®¿é—®æ—¥å¿—çš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º <code>&lt;prefix&gt;</code>/- logs/access.logã€‚</td></tr> <tr><td style="text-align:left;">â€“user=<code>&lt;user&gt;</code></td> <td style="text-align:left;">åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šuseræŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginxä½¿ç”¨çš„ç”¨æˆ·ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º nobodyã€‚</td></tr> <tr><td style="text-align:left;">â€“group=<code>&lt;group&gt;</code></td> <td style="text-align:left;">åœ¨nginx.confä¸­æ²¡æœ‰æŒ‡å®šuseræŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„nginxä½¿ç”¨çš„ç»„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸º nobodyã€‚</td></tr> <tr><td style="text-align:left;">â€“builddir=DIR</td> <td style="text-align:left;">æŒ‡å®šç¼–è¯‘çš„ç›®å½•</td></tr> <tr><td style="text-align:left;">â€“with-rtsig_module</td> <td style="text-align:left;">å¯ç”¨ rtsig æ¨¡å—</td></tr> <tr><td style="text-align:left;">â€“with-select_module â€“without-select_module</td> <td style="text-align:left;">å…è®¸æˆ–ä¸å…è®¸å¼€å¯SELECTæ¨¡å¼ï¼Œå¦‚æœ configure æ²¡æœ‰æ‰¾åˆ°æ›´åˆé€‚çš„æ¨¡å¼ï¼Œæ¯”å¦‚ï¼škqueue(sun os),epoll (linux kenel 2.6+), rtsig(- å®æ—¶ä¿¡å·)æˆ–è€…/dev/poll(ä¸€ç§ç±»ä¼¼selectçš„æ¨¡å¼ï¼Œåº•å±‚å®ç°ä¸SELECTåŸºæœ¬ç›¸ åŒï¼Œéƒ½æ˜¯é‡‡ç”¨è½®è®­æ–¹æ³•) SELECTæ¨¡å¼å°†æ˜¯é»˜è®¤å®‰è£…æ¨¡å¼</td></tr> <tr><td style="text-align:left;">â€“with-poll_module â€“without-poll_module</td> <td style="text-align:left;">Whether or not to enable the poll module. This module is enabled by, default if a more suitable method such as kqueue, epoll, rtsig or /dev/poll is not discovered by configure.</td></tr> <tr><td style="text-align:left;">â€“with-http_ssl_module</td> <td style="text-align:left;">Enable ngx_http_ssl_module. Enables SSL support and the ability to handle HTTPS requests. Requires OpenSSL. On Debian, this is libssl-dev. å¼€å¯HTTP SSLæ¨¡å—ï¼Œä½¿NGINXå¯ä»¥æ”¯æŒHTTPSè¯·æ±‚ã€‚è¿™ä¸ªæ¨¡å—éœ€è¦å·²ç»å®‰è£…äº†OPENSSLï¼Œåœ¨DEBIANä¸Šæ˜¯libssl</td></tr> <tr><td style="text-align:left;">â€“with-http_realip_module</td> <td style="text-align:left;">å¯ç”¨ ngx_http_realip_module</td></tr> <tr><td style="text-align:left;">â€“with-http_addition_module</td> <td style="text-align:left;">å¯ç”¨ ngx_http_addition_module</td></tr> <tr><td style="text-align:left;">â€“with-http_sub_module</td> <td style="text-align:left;">å¯ç”¨ ngx_http_sub_module</td></tr> <tr><td style="text-align:left;">â€“with-http_dav_module</td> <td style="text-align:left;">å¯ç”¨ ngx_http_dav_module</td></tr> <tr><td style="text-align:left;">â€“with-http_flv_module</td> <td style="text-align:left;">å¯ç”¨ ngx_http_flv_module</td></tr> <tr><td style="text-align:left;">â€“with-http_stub_status_module</td> <td style="text-align:left;">å¯ç”¨ â€œserver statusâ€ é¡µ</td></tr> <tr><td style="text-align:left;">â€“without-http_charset_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_charset_module</td></tr> <tr><td style="text-align:left;">â€“without-http_gzip_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_gzip_module. å¦‚æœå¯ç”¨ï¼Œéœ€è¦ zlib ã€‚</td></tr> <tr><td style="text-align:left;">â€“without-http_ssi_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_ssi_module</td></tr> <tr><td style="text-align:left;">â€“without-http_userid_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_userid_module</td></tr> <tr><td style="text-align:left;">â€“without-http_access_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_access_module</td></tr> <tr><td style="text-align:left;">â€“without-http_auth_basic_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_auth_basic_module</td></tr> <tr><td style="text-align:left;">â€“without-http_autoindex_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_autoindex_module</td></tr> <tr><td style="text-align:left;">â€“without-http_geo_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_geo_module</td></tr> <tr><td style="text-align:left;">â€“without-http_map_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_map_module</td></tr> <tr><td style="text-align:left;">â€“without-http_referer_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_referer_module</td></tr> <tr><td style="text-align:left;">â€“without-http_rewrite_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_rewrite_module. å¦‚æœå¯ç”¨éœ€è¦ PCRE ã€‚</td></tr> <tr><td style="text-align:left;">â€“without-http_proxy_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_proxy_module</td></tr> <tr><td style="text-align:left;">â€“without-http_fastcgi_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_fastcgi_module</td></tr> <tr><td style="text-align:left;">â€“without-http_memcached_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_memcached_module</td></tr> <tr><td style="text-align:left;">â€“without-http_limit_zone_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_limit_zone_module</td></tr> <tr><td style="text-align:left;">â€“without-http_empty_gif_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_empty_gif_module</td></tr> <tr><td style="text-align:left;">â€“without-http_browser_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_browser_module</td></tr> <tr><td style="text-align:left;">â€“without-http_upstream_ip_hash_module</td> <td style="text-align:left;">ç¦ç”¨ ngx_http_upstream_ip_hash_module</td></tr> <tr><td style="text-align:left;">â€“with-http_perl_module</td> <td style="text-align:left;">å¯ç”¨ ngx_http_perl_module</td></tr> <tr><td style="text-align:left;">â€“with-perl_modules_path=PATH</td> <td style="text-align:left;">æŒ‡å®š perl æ¨¡å—çš„è·¯å¾„</td></tr> <tr><td style="text-align:left;">â€“with-perl=PATH</td> <td style="text-align:left;">æŒ‡å®š perl æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„</td></tr> <tr><td style="text-align:left;">â€“http-log-path=PATH</td> <td style="text-align:left;">Set path to the http access log</td></tr> <tr><td style="text-align:left;">â€“http-client-body-temp-path=PATH</td> <td style="text-align:left;">Set path to the http client request body temporary files</td></tr> <tr><td style="text-align:left;">â€“http-proxy-temp-path=PATH</td> <td style="text-align:left;">Set path to the http proxy temporary files</td></tr> <tr><td style="text-align:left;">â€“http-fastcgi-temp-path=PATH</td> <td style="text-align:left;">Set path to the http fastcgi temporary files</td></tr> <tr><td style="text-align:left;">â€“without-http</td> <td style="text-align:left;">ç¦ç”¨ HTTP server</td></tr> <tr><td style="text-align:left;">â€“with-mail</td> <td style="text-align:left;">å¯ç”¨ IMAP4/POP3/SMTP ä»£ç†æ¨¡å—</td></tr> <tr><td style="text-align:left;">â€“with-mail_ssl_module</td> <td style="text-align:left;">å¯ç”¨ ngx_mail_ssl_module</td></tr> <tr><td style="text-align:left;">â€“with-cc=PATH</td> <td style="text-align:left;">æŒ‡å®š C ç¼–è¯‘å™¨çš„è·¯å¾„</td></tr> <tr><td style="text-align:left;">â€“with-cpp=PATH</td> <td style="text-align:left;">æŒ‡å®š C é¢„å¤„ç†å™¨çš„è·¯å¾„</td></tr> <tr><td style="text-align:left;">â€“with-cc-opt=OPTIONS</td> <td style="text-align:left;">Additional parameters which will be added to the variable CFLAGS. With the use of the system library PCRE in FreeBSD, it is necessary to indicate â€“with-cc-opt=â€-I /usr/local/includeâ€. If we are using select() and it is necessary to increase the number of file descriptors, then this also can be assigned here: â€“with-cc-opt=â€-D FD_SETSIZE=2048â€.</td></tr> <tr><td style="text-align:left;">â€“with-ld-opt=OPTIONS</td> <td style="text-align:left;">Additional parameters passed to the linker. With the use of the system library PCRE in - FreeBSD, it is necessary to indicate â€“with-ld-opt=â€-L /usr/local/libâ€.</td></tr> <tr><td style="text-align:left;">â€“with-cpu-opt=CPU</td> <td style="text-align:left;">ä¸ºç‰¹å®šçš„ CPU ç¼–è¯‘ï¼Œæœ‰æ•ˆçš„å€¼åŒ…æ‹¬ï¼špentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64</td></tr> <tr><td style="text-align:left;">â€“without-pcre</td> <td style="text-align:left;">ç¦æ­¢ PCRE åº“çš„ä½¿ç”¨ã€‚åŒæ—¶ä¹Ÿä¼šç¦æ­¢ HTTP rewrite æ¨¡å—ã€‚åœ¨ â€œlocationâ€ é…ç½®æŒ‡ä»¤ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿéœ€è¦ PCRE ã€‚</td></tr> <tr><td style="text-align:left;">â€“with-pcre=DIR</td> <td style="text-align:left;">æŒ‡å®š PCRE åº“çš„æºä»£ç çš„è·¯å¾„ã€‚</td></tr> <tr><td style="text-align:left;">â€“with-pcre-opt=OPTIONS</td> <td style="text-align:left;">Set additional options for PCRE building.</td></tr> <tr><td style="text-align:left;">â€“with-md5=DIR</td> <td style="text-align:left;">Set path to md5 library sources.</td></tr> <tr><td style="text-align:left;">â€“with-md5-opt=OPTIONS</td> <td style="text-align:left;">Set additional options for md5 building.</td></tr> <tr><td style="text-align:left;">â€“with-md5-asm</td> <td style="text-align:left;">Use md5 assembler sources.</td></tr> <tr><td style="text-align:left;">â€“with-sha1=DIR</td> <td style="text-align:left;">Set path to sha1 library sources.</td></tr> <tr><td style="text-align:left;">â€“with-sha1-opt=OPTIONS</td> <td style="text-align:left;">Set additional options for sha1 building.</td></tr> <tr><td style="text-align:left;">â€“with-sha1-asm</td> <td style="text-align:left;">Use sha1 assembler sources.</td></tr> <tr><td style="text-align:left;">â€“with-zlib=DIR</td> <td style="text-align:left;">Set path to zlib library sources.</td></tr> <tr><td style="text-align:left;">â€“with-zlib-opt=OPTIONS</td> <td style="text-align:left;">Set additional options for zlib building.</td></tr> <tr><td style="text-align:left;">â€“with-zlib-asm=CPU</td> <td style="text-align:left;">Use zlib assembler sources optimized for specified CPU, valid values are: pentium, pentiumpro</td></tr> <tr><td style="text-align:left;">â€“with-openssl=DIR</td> <td style="text-align:left;">Set path to OpenSSL library sources</td></tr> <tr><td style="text-align:left;">â€“with-openssl-opt=OPTIONS</td> <td style="text-align:left;">Set additional options for OpenSSL building</td></tr> <tr><td style="text-align:left;">â€“with-debug</td> <td style="text-align:left;">å¯ç”¨è°ƒè¯•æ—¥å¿—</td></tr> <tr><td style="text-align:left;">â€“add-module=PATH</td> <td style="text-align:left;">Add in a third-party module found in directory PATH</td></tr></tbody></table> <h2 id="é…ç½®"><a href="#é…ç½®" class="header-anchor">#</a> é…ç½®</h2> <p>åœ¨Centos é»˜è®¤é…ç½®æ–‡ä»¶åœ¨ <strong>/usr/local/nginx-1.5.1/conf/nginx.conf</strong> æˆ‘ä»¬è¦åœ¨è¿™é‡Œé…ç½®ä¸€äº›æ–‡ä»¶ã€‚nginx.confæ˜¯ä¸»é…ç½®æ–‡ä»¶ï¼Œç”±è‹¥å¹²ä¸ªéƒ¨åˆ†ç»„æˆï¼Œæ¯ä¸ªå¤§æ‹¬å·<code>{}</code>è¡¨ç¤ºä¸€ä¸ªéƒ¨åˆ†ã€‚æ¯ä¸€è¡ŒæŒ‡ä»¤éƒ½ç”±åˆ†å·ç»“æŸ<code>;</code>ï¼Œæ ‡å¿—ç€ä¸€è¡Œçš„ç»“æŸã€‚</p> <h3 id="å¸¸ç”¨æ­£åˆ™"><a href="#å¸¸ç”¨æ­£åˆ™" class="header-anchor">#</a> å¸¸ç”¨æ­£åˆ™</h3> <table><thead><tr><th style="text-align:left;">æ­£åˆ™</th> <th style="text-align:left;">è¯´æ˜</th> <th style="text-align:left;">æ­£åˆ™</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>.</code></td> <td style="text-align:left;">åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦</td> <td style="text-align:left;"><code>$</code></td> <td style="text-align:left;">åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ</td></tr> <tr><td style="text-align:left;"><code>?</code></td> <td style="text-align:left;">é‡å¤0æ¬¡æˆ–1æ¬¡</td> <td style="text-align:left;"><code>{n}</code></td> <td style="text-align:left;">é‡å¤næ¬¡</td></tr> <tr><td style="text-align:left;"><code>+</code></td> <td style="text-align:left;">é‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡</td> <td style="text-align:left;"><code>{n,}</code></td> <td style="text-align:left;">é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡</td></tr> <tr><td style="text-align:left;"><code>*</code></td> <td style="text-align:left;">é‡å¤0æ¬¡æˆ–æ›´å¤šæ¬¡</td> <td style="text-align:left;"><code>[c]</code></td> <td style="text-align:left;">åŒ¹é…å•ä¸ªå­—ç¬¦c</td></tr> <tr><td style="text-align:left;"><code>\d</code></td> <td style="text-align:left;">åŒ¹é…æ•°å­—</td> <td style="text-align:left;"><code>[a-z]</code></td> <td style="text-align:left;">åŒ¹é…a-zå°å†™å­—æ¯çš„ä»»æ„ä¸€ä¸ª</td></tr> <tr><td style="text-align:left;"><code>^</code></td> <td style="text-align:left;">åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹</td> <td style="text-align:left;">-</td> <td style="text-align:left;">-</td></tr></tbody></table> <h3 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="header-anchor">#</a> å…¨å±€å˜é‡</h3> <table><thead><tr><th style="text-align:left;">å˜é‡</th> <th style="text-align:left;">è¯´æ˜</th> <th style="text-align:left;">å˜é‡</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">$args</td> <td style="text-align:left;">è¿™ä¸ªå˜é‡ç­‰äºè¯·æ±‚è¡Œä¸­çš„å‚æ•°ï¼ŒåŒ$query_string</td> <td style="text-align:left;">$remote_port</td> <td style="text-align:left;">å®¢æˆ·ç«¯çš„ç«¯å£ã€‚</td></tr> <tr><td style="text-align:left;">$content_length</td> <td style="text-align:left;">è¯·æ±‚å¤´ä¸­çš„Content-lengthå­—æ®µã€‚</td> <td style="text-align:left;">$remote_user</td> <td style="text-align:left;">å·²ç»ç»è¿‡Auth Basic ModuleéªŒè¯çš„ç”¨æˆ·åã€‚</td></tr> <tr><td style="text-align:left;">$content_type</td> <td style="text-align:left;">è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µã€‚</td> <td style="text-align:left;">$request_filename</td> <td style="text-align:left;">å½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆã€‚</td></tr> <tr><td style="text-align:left;">$document_root</td> <td style="text-align:left;">å½“å‰è¯·æ±‚åœ¨rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ã€‚</td> <td style="text-align:left;">$scheme</td> <td style="text-align:left;">HTTPæ–¹æ³•ï¼ˆå¦‚httpï¼Œhttpsï¼‰ã€‚</td></tr> <tr><td style="text-align:left;">$host</td> <td style="text-align:left;">è¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°ã€‚</td> <td style="text-align:left;">$server_protocol</td> <td style="text-align:left;">è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯HTTP/1.0æˆ–HTTP/1.1ã€‚</td></tr> <tr><td style="text-align:left;">$http_user_agent</td> <td style="text-align:left;">å®¢æˆ·ç«¯agentä¿¡æ¯</td> <td style="text-align:left;">$server_addr</td> <td style="text-align:left;">æœåŠ¡å™¨åœ°å€ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨åå¯ä»¥ç¡®å®šè¿™ä¸ªå€¼ã€‚</td></tr> <tr><td style="text-align:left;">$http_cookie</td> <td style="text-align:left;">å®¢æˆ·ç«¯cookieä¿¡æ¯</td> <td style="text-align:left;">$server_name</td> <td style="text-align:left;">æœåŠ¡å™¨åç§°ã€‚</td></tr> <tr><td style="text-align:left;">$limit_rate</td> <td style="text-align:left;">è¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡ã€‚</td> <td style="text-align:left;">$server_port</td> <td style="text-align:left;">è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·ã€‚</td></tr> <tr><td style="text-align:left;">$request_method</td> <td style="text-align:left;">å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸ºGETæˆ–POSTã€‚</td> <td style="text-align:left;">$request_uri</td> <td style="text-align:left;">åŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œå¦‚ï¼š/foo/bar.php?arg=bazã€‚</td></tr> <tr><td style="text-align:left;">$remote_addr</td> <td style="text-align:left;">å®¢æˆ·ç«¯çš„IPåœ°å€ã€‚</td> <td style="text-align:left;">$uri</td> <td style="text-align:left;">ä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰URIï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚/foo/bar.htmlã€‚</td></tr> <tr><td style="text-align:left;">$document_uri</td> <td style="text-align:left;">ä¸$uriç›¸åŒã€‚</td> <td style="text-align:left;">-</td> <td style="text-align:left;">-</td></tr></tbody></table> <p>ä¾‹å¦‚è¯·æ±‚ï¼š<code>http://localhost:3000/test1/test2/test.php</code></p> <p>$hostï¼šlocalhost
$server_portï¼š3000
$request_uriï¼š/test1/test2/test.php
$document_uriï¼š/test1/test2/test.php
$document_rootï¼š/var/www/html
$request_filenameï¼š/var/www/html/test1/test2/test.php</p> <h3 id="ç¬¦å·å‚è€ƒ"><a href="#ç¬¦å·å‚è€ƒ" class="header-anchor">#</a> ç¬¦å·å‚è€ƒ</h3> <table><thead><tr><th style="text-align:left;">ç¬¦å·</th> <th style="text-align:left;">è¯´æ˜</th> <th style="text-align:left;">ç¬¦å·</th> <th style="text-align:left;">è¯´æ˜</th> <th style="text-align:left;">ç¬¦å·</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">k,K</td> <td style="text-align:left;">åƒå­—èŠ‚</td> <td style="text-align:left;">m,M</td> <td style="text-align:left;">å…†å­—èŠ‚</td> <td style="text-align:left;">ms</td> <td style="text-align:left;">æ¯«ç§’</td></tr> <tr><td style="text-align:left;">s</td> <td style="text-align:left;">ç§’</td> <td style="text-align:left;">m</td> <td style="text-align:left;">åˆ†é’Ÿ</td> <td style="text-align:left;">h</td> <td style="text-align:left;">å°æ—¶</td></tr> <tr><td style="text-align:left;">d</td> <td style="text-align:left;">æ—¥</td> <td style="text-align:left;">w</td> <td style="text-align:left;">å‘¨</td> <td style="text-align:left;">M</td> <td style="text-align:left;">ä¸€ä¸ªæœˆ, 30å¤©</td></tr></tbody></table> <p>ä¾‹å¦‚ï¼Œâ€8kâ€ï¼Œâ€1mâ€ ä»£è¡¨å­—èŠ‚æ•°è®¡é‡ã€‚
ä¾‹å¦‚ï¼Œâ€1h 30mâ€ï¼Œâ€1y 6Mâ€ã€‚ä»£è¡¨ â€œ1å°æ—¶ 30åˆ†â€ï¼Œâ€1å¹´é›¶6ä¸ªæœˆâ€ã€‚</p> <h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="header-anchor">#</a> é…ç½®æ–‡ä»¶</h3> <p>nginx çš„é…ç½®ç³»ç»Ÿç”±ä¸€ä¸ªä¸»é…ç½®æ–‡ä»¶å’Œå…¶ä»–ä¸€äº›è¾…åŠ©çš„é…ç½®æ–‡ä»¶æ„æˆã€‚è¿™äº›é…ç½®æ–‡ä»¶å‡æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå…¨éƒ¨ä½äº nginx å®‰è£…ç›®å½•ä¸‹çš„ conf ç›®å½•ä¸‹ã€‚</p> <p>æŒ‡ä»¤ç”± nginx çš„å„ä¸ªæ¨¡å—æä¾›ï¼Œä¸åŒçš„æ¨¡å—ä¼šæä¾›ä¸åŒçš„æŒ‡ä»¤æ¥å®ç°é…ç½®ã€‚
æŒ‡ä»¤é™¤äº† Key-Value çš„å½¢å¼ï¼Œè¿˜æœ‰ä½œç”¨åŸŸæŒ‡ä»¤ã€‚</p> <p>nginx.conf ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œæ ¹æ®å…¶é€»è¾‘ä¸Šçš„æ„ä¹‰ï¼Œå¯¹å®ƒä»¬è¿›è¡Œäº†åˆ†ç±»ï¼Œä¹Ÿå°±æ˜¯åˆ†æˆäº†å¤šä¸ªä½œç”¨åŸŸï¼Œæˆ–è€…ç§°ä¹‹ä¸ºé…ç½®æŒ‡ä»¤ä¸Šä¸‹æ–‡ã€‚ä¸åŒçš„ä½œç”¨åŸŸå«æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªé…ç½®é¡¹ã€‚</p> <p>ä¸‹é¢çš„è¿™äº›ä¸Šä¸‹æ–‡æŒ‡ä»¤æ˜¯ç”¨çš„æ¯”è¾ƒå¤šï¼š</p> <table><thead><tr><th style="text-align:left;">Directive</th> <th style="text-align:left;">Description</th> <th style="text-align:left;">Contains Directive</th></tr></thead> <tbody><tr><td style="text-align:left;">main</td> <td style="text-align:left;">nginx åœ¨è¿è¡Œæ—¶ä¸å…·ä½“ä¸šåŠ¡åŠŸèƒ½ï¼ˆæ¯”å¦‚ http æœåŠ¡æˆ–è€… email æœåŠ¡ä»£ç†ï¼‰æ— å…³çš„ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚å·¥ä½œè¿›ç¨‹æ•°ï¼Œè¿è¡Œçš„èº«ä»½ç­‰ã€‚</td> <td style="text-align:left;">user, worker_processes, error_log, events, http, mail</td></tr> <tr><td style="text-align:left;">http</td> <td style="text-align:left;">ä¸æä¾› http æœåŠ¡ç›¸å…³çš„ä¸€äº›é…ç½®å‚æ•°ã€‚ä¾‹å¦‚ï¼šæ˜¯å¦ä½¿ç”¨ keepalive å•Šï¼Œæ˜¯å¦ä½¿ç”¨ gzip è¿›è¡Œå‹ç¼©ç­‰ã€‚</td> <td style="text-align:left;">server</td></tr> <tr><td style="text-align:left;">server</td> <td style="text-align:left;">http æœåŠ¡ä¸Šæ”¯æŒè‹¥å¹²è™šæ‹Ÿä¸»æœºã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºä¸€ä¸ªå¯¹åº”çš„ server é…ç½®é¡¹ï¼Œé…ç½®é¡¹é‡Œé¢åŒ…å«è¯¥è™šæ‹Ÿä¸»æœºç›¸å…³çš„é…ç½®ã€‚åœ¨æä¾› mail æœåŠ¡çš„ä»£ç†æ—¶ï¼Œä¹Ÿå¯ä»¥å»ºç«‹è‹¥å¹² server. æ¯ä¸ª server é€šè¿‡ç›‘å¬çš„åœ°å€æ¥åŒºåˆ†ã€‚</td> <td style="text-align:left;">listen, server_name, access_log, location, protocol, proxy, smtp_auth, xclient</td></tr> <tr><td style="text-align:left;">location</td> <td style="text-align:left;">http æœåŠ¡ä¸­ï¼ŒæŸäº›ç‰¹å®šçš„ URL å¯¹åº”çš„ä¸€ç³»åˆ—é…ç½®é¡¹ã€‚</td> <td style="text-align:left;">index, root</td></tr> <tr><td style="text-align:left;">mail</td> <td style="text-align:left;">å®ç° email ç›¸å…³çš„ SMTP/IMAP/POP3 ä»£ç†æ—¶ï¼Œå…±äº«çš„ä¸€äº›é…ç½®é¡¹ï¼ˆå› ä¸ºå¯èƒ½å®ç°å¤šä¸ªä»£ç†ï¼Œå·¥ä½œåœ¨å¤šä¸ªç›‘å¬åœ°å€ä¸Šï¼‰ã€‚</td> <td style="text-align:left;">server, http, imap_capabilities</td></tr> <tr><td style="text-align:left;">include</td> <td style="text-align:left;">ä»¥ä¾¿å¢å¼ºé…ç½®æ–‡ä»¶çš„å¯è¯»æ€§ï¼Œä½¿å¾—éƒ¨åˆ†é…ç½®æ–‡ä»¶å¯ä»¥é‡æ–°ä½¿ç”¨ã€‚</td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;">valid_referers</td> <td style="text-align:left;">ç”¨æ¥æ ¡éªŒHttpè¯·æ±‚å¤´Refereræ˜¯å¦æœ‰æ•ˆã€‚</td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;">try_files</td> <td style="text-align:left;">ç”¨åœ¨serveréƒ¨åˆ†ï¼Œä¸è¿‡æœ€å¸¸è§çš„è¿˜æ˜¯ç”¨åœ¨locationéƒ¨åˆ†ï¼Œå®ƒä¼šæŒ‰ç…§ç»™å®šçš„å‚æ•°é¡ºåºè¿›è¡Œå°è¯•ï¼Œç¬¬ä¸€ä¸ªè¢«åŒ¹é…åˆ°çš„å°†ä¼šè¢«ä½¿ç”¨ã€‚</td> <td style="text-align:left;">-</td></tr> <tr><td style="text-align:left;">if</td> <td style="text-align:left;">å½“åœ¨locationå—ä¸­ä½¿ç”¨ifæŒ‡ä»¤ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å®ƒå¹¶ä¸æŒ‰ç…§é¢„æœŸè¿è¡Œï¼Œä¸€èˆ¬æ¥è¯´é¿å…ä½¿ç”¨ifæŒ‡ä»¤ã€‚</td> <td style="text-align:left;">-</td></tr></tbody></table> <p>ä¾‹å¦‚æˆ‘ä»¬å† <strong>nginx.conf</strong> é‡Œé¢å¼•ç”¨ä¸¤ä¸ªé…ç½® vhost/example.com.conf å’Œ vhost/gitlab.com.conf å®ƒä»¬éƒ½è¢«æ”¾åœ¨ä¸€ä¸ªæˆ‘è‡ªå·±æ–°å»ºçš„ç›®å½• vhost ä¸‹é¢ã€‚nginx.conf é…ç½®å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶worker_processes  1;
events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
    #                  '$status $body_bytes_sent &quot;$http_referer&quot; '
    #                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;
    server {
        listen       80;
        server_name  localhost;
        location / {
            root   html;
            index  index.html index.htm;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
    include  vhost/example.com.conf;
    include  vhost/gitlab.com.conf;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>ç®€å•çš„é…ç½®: example.com.conf</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶server {
    #ä¾¦å¬çš„80ç«¯å£
    listen       80;
    server_name  baidu.com app.baidu.com; # è¿™é‡ŒæŒ‡å®šåŸŸå
    index        index.html index.htm;    # è¿™é‡ŒæŒ‡å®šé»˜è®¤å…¥å£é¡µé¢
    root /home/www/app.baidu.com;         # è¿™é‡ŒæŒ‡å®šç›®å½•
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="å†…ç½®é¢„å®šä¹‰å˜é‡"><a href="#å†…ç½®é¢„å®šä¹‰å˜é‡" class="header-anchor">#</a> å†…ç½®é¢„å®šä¹‰å˜é‡</h3> <p>Nginxæä¾›äº†è®¸å¤šé¢„å®šä¹‰çš„å˜é‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨setæ¥è®¾ç½®å˜é‡ã€‚ä½ å¯ä»¥åœ¨ifä¸­ä½¿ç”¨é¢„å®šä¹‰å˜é‡ï¼Œä¹Ÿå¯ä»¥å°†å®ƒä»¬ä¼ é€’ç»™ä»£ç†æœåŠ¡å™¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é¢„å®šä¹‰å˜é‡ï¼Œ<a href="http://nginx.org/en/docs/varindex.html" target="_blank" rel="noopener noreferrer">æ›´å¤šè¯¦è§<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <table><thead><tr><th style="text-align:left;">å˜é‡åç§°</th> <th style="text-align:left;">å€¼</th></tr></thead> <tbody><tr><td style="text-align:left;">$args_name</td> <td style="text-align:left;">åœ¨è¯·æ±‚ä¸­çš„nameå‚æ•°</td></tr> <tr><td style="text-align:left;">$args</td> <td style="text-align:left;">æ‰€æœ‰è¯·æ±‚å‚æ•°</td></tr> <tr><td style="text-align:left;">$query_string</td> <td style="text-align:left;">$argsçš„åˆ«å</td></tr> <tr><td style="text-align:left;">$content_length</td> <td style="text-align:left;">è¯·æ±‚å¤´Content-Lengthçš„å€¼</td></tr> <tr><td style="text-align:left;">$content_type</td> <td style="text-align:left;">è¯·æ±‚å¤´Content-Typeçš„å€¼</td></tr> <tr><td style="text-align:left;">$host</td> <td style="text-align:left;">å¦‚æœå½“å‰æœ‰Hostï¼Œåˆ™ä¸ºè¯·æ±‚å¤´Hostçš„å€¼ï¼›å¦‚æœæ²¡æœ‰è¿™ä¸ªå¤´ï¼Œé‚£ä¹ˆè¯¥å€¼ç­‰äºåŒ¹é…è¯¥è¯·æ±‚çš„server_nameçš„å€¼</td></tr> <tr><td style="text-align:left;">$remote_addr</td> <td style="text-align:left;">å®¢æˆ·ç«¯çš„IPåœ°å€</td></tr> <tr><td style="text-align:left;">$request</td> <td style="text-align:left;">å®Œæ•´çš„è¯·æ±‚ï¼Œä»å®¢æˆ·ç«¯æ”¶åˆ°ï¼ŒåŒ…æ‹¬Httpè¯·æ±‚æ–¹æ³•ã€URIã€Httpåè®®ã€å¤´ã€è¯·æ±‚ä½“</td></tr> <tr><td style="text-align:left;">$request_uri</td> <td style="text-align:left;">å®Œæ•´è¯·æ±‚çš„URIï¼Œä»å®¢æˆ·ç«¯æ¥çš„è¯·æ±‚ï¼ŒåŒ…æ‹¬å‚æ•°</td></tr> <tr><td style="text-align:left;">$scheme</td> <td style="text-align:left;">å½“å‰è¯·æ±‚çš„åè®®</td></tr> <tr><td style="text-align:left;">$uri</td> <td style="text-align:left;">å½“å‰è¯·æ±‚çš„æ ‡å‡†åŒ–URI</td></tr></tbody></table> <h3 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="header-anchor">#</a> åå‘ä»£ç†</h3> <p>åå‘ä»£ç†æ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œå®ƒæ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨å¾—åˆ°çš„ç»“æœè¿”å›ç»™è¿æ¥çš„å®¢æˆ·ç«¯ã€‚ä¸‹é¢ç®€å•çš„åå‘ä»£ç†çš„ä¾‹å­ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶server {  
  listen       80;                                                        
  server_name  localhost;                                              
  client_max_body_size 1024M;  # å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°

  location / {
    proxy_pass                         http://localhost:8080;
    proxy_set_header Host              $host:$server_port;
    proxy_set_header X-Forwarded-For   $remote_addr; # HTTPçš„è¯·æ±‚ç«¯çœŸå®çš„IP
    proxy_set_header X-Forwarded-Proto $scheme;      # ä¸ºäº†æ­£ç¡®åœ°è¯†åˆ«å®é™…ç”¨æˆ·å‘å‡ºçš„åè®®æ˜¯ http è¿˜æ˜¯ https
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>å¤æ‚çš„é…ç½®: gitlab.com.confã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶server {
    #ä¾¦å¬çš„80ç«¯å£
    listen       80;
    server_name  git.example.cn;
    location / {
        proxy_pass   http://localhost:3000;
        #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤
        proxy_redirect             off;
        #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP
        proxy_set_header           Host $host;
        client_max_body_size       10m; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°
        client_body_buffer_size    128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°
        proxy_connect_timeout      300; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)
        proxy_send_timeout         300; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)
        proxy_read_timeout         300; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)
        proxy_buffer_size          4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°
        proxy_buffers              4 32k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®
        proxy_busy_buffers_size    64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>ä»£ç†åˆ°ä¸Šæ¸¸æœåŠ¡å™¨çš„é…ç½®ä¸­ï¼Œæœ€é‡è¦çš„æ˜¯proxy_passæŒ‡ä»¤ã€‚ä»¥ä¸‹æ˜¯ä»£ç†æ¨¡å—ä¸­çš„ä¸€äº›å¸¸ç”¨æŒ‡ä»¤ï¼š</p> <table><thead><tr><th style="text-align:left;">æŒ‡ä»¤</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">proxy_connect_timeout</td> <td style="text-align:left;">Nginxä»æ¥å—è¯·æ±‚è‡³è¿æ¥åˆ°ä¸Šæ¸¸æœåŠ¡å™¨çš„æœ€é•¿ç­‰å¾…æ—¶é—´</td></tr> <tr><td style="text-align:left;">proxy_send_timeout</td> <td style="text-align:left;">åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</td></tr> <tr><td style="text-align:left;">proxy_read_timeout</td> <td style="text-align:left;">è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</td></tr> <tr><td style="text-align:left;">proxy_cookie_domain</td> <td style="text-align:left;">æ›¿ä»£ä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥çš„Set-Cookieå¤´çš„domainå±æ€§</td></tr> <tr><td style="text-align:left;">proxy_cookie_path</td> <td style="text-align:left;">æ›¿ä»£ä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥çš„Set-Cookieå¤´çš„pathå±æ€§</td></tr> <tr><td style="text-align:left;">proxy_buffer_size</td> <td style="text-align:left;">è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</td></tr> <tr><td style="text-align:left;">proxy_buffers</td> <td style="text-align:left;">proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨å¤šå°‘kä»¥ä¸‹</td></tr> <tr><td style="text-align:left;">proxy_set_header</td> <td style="text-align:left;">é‡å†™å‘é€åˆ°ä¸Šæ¸¸æœåŠ¡å™¨å¤´çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°†æŸä¸ªå¤´éƒ¨çš„å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè€Œä¸å‘é€æŸä¸ªå¤´éƒ¨çš„æ–¹æ³•å®ç°</td></tr> <tr><td style="text-align:left;">proxy_ignore_headers</td> <td style="text-align:left;">è¿™ä¸ªæŒ‡ä»¤ç¦æ­¢å¤„ç†æ¥è‡ªä»£ç†æœåŠ¡å™¨çš„åº”ç­”ã€‚</td></tr> <tr><td style="text-align:left;">proxy_intercept_errors</td> <td style="text-align:left;">ä½¿nginxé˜»æ­¢HTTPåº”ç­”ä»£ç ä¸º400æˆ–è€…æ›´é«˜çš„åº”ç­”ã€‚</td></tr></tbody></table> <h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="header-anchor">#</a> è´Ÿè½½å‡è¡¡</h3> <p>upstreamæŒ‡ä»¤å¯ç”¨ä¸€ä¸ªæ–°çš„é…ç½®åŒºæ®µï¼Œåœ¨è¯¥åŒºæ®µå®šä¹‰ä¸€ç»„ä¸Šæ¸¸æœåŠ¡å™¨ã€‚è¿™äº›æœåŠ¡å™¨å¯èƒ½è¢«è®¾ç½®ä¸åŒçš„æƒé‡ï¼Œä¹Ÿå¯èƒ½å‡ºäºå¯¹æœåŠ¡å™¨è¿›è¡Œç»´æŠ¤ï¼Œæ ‡è®°ä¸ºdownã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶upstream gitlab {
    ip_hash;
    # upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚
    server 192.168.122.11:8081 ;
    server 127.0.0.1:82 weight=3;
    server 127.0.0.1:83 weight=3 down;
    server 127.0.0.1:84 weight=3; max_fails=3  fail_timeout=20s;
    server 127.0.0.1:85 weight=4;;
    keepalive 32;
}
server {
    #ä¾¦å¬çš„80ç«¯å£
    listen       80;
    server_name  git.example.cn;
    location / {
        proxy_pass   http://gitlab;    #åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸ªä»£ç†ï¼Œå’Œupstreamçš„åå­—ä¸€æ ·
        #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤
        proxy_redirect             off;
        #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP
        proxy_set_header           Host $host;
        proxy_set_header           X-Real-IP $remote_addr;
        proxy_set_header           X-Forwarded-For $proxy_add_x_forwarded_for;
        client_max_body_size       10m;  #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°
        client_body_buffer_size    128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°
        proxy_connect_timeout      300;  #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)
        proxy_send_timeout         300;  #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)
        proxy_read_timeout         300;  #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)
        proxy_buffer_size          4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°
        proxy_buffers              4 32k;# ç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®
        proxy_busy_buffers_size    64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰
        proxy_temp_file_write_size 64k; #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ 
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚</p> <p><strong>è´Ÿè½½å‡è¡¡ï¼š</strong></p> <p>upstreamæ¨¡å—èƒ½å¤Ÿä½¿ç”¨3ç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šè½®è¯¢ã€IPå“ˆå¸Œã€æœ€å°‘è¿æ¥æ•°ã€‚</p> <p><strong>è½®è¯¢ï¼š</strong> é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨è½®è¯¢ç®—æ³•ï¼Œä¸éœ€è¦é…ç½®æŒ‡ä»¤æ¥æ¿€æ´»å®ƒï¼Œå®ƒæ˜¯åŸºäºåœ¨é˜Ÿåˆ—ä¸­è°æ˜¯ä¸‹ä¸€ä¸ªçš„åŸç†ç¡®ä¿è®¿é—®å‡åŒ€åœ°åˆ†å¸ƒåˆ°æ¯ä¸ªä¸Šæ¸¸æœåŠ¡å™¨ï¼›
<strong>IPå“ˆå¸Œï¼š</strong> é€šè¿‡ip_hashæŒ‡ä»¤æ¥æ¿€æ´»ï¼ŒNginxé€šè¿‡IPv4åœ°å€çš„å‰3ä¸ªå­—èŠ‚æˆ–è€…æ•´ä¸ªIPv6åœ°å€ä½œä¸ºå“ˆå¸Œé”®æ¥å®ç°ï¼ŒåŒä¸€ä¸ªIPåœ°å€æ€»æ˜¯èƒ½è¢«æ˜ å°„åˆ°åŒä¸€ä¸ªä¸Šæ¸¸æœåŠ¡å™¨ï¼›
<strong>æœ€å°‘è¿æ¥æ•°ï¼š</strong> é€šè¿‡least_connæŒ‡ä»¤æ¥æ¿€æ´»ï¼Œè¯¥ç®—æ³•é€šè¿‡é€‰æ‹©ä¸€ä¸ªæ´»è·ƒæ•°æœ€å°‘çš„ä¸Šæ¸¸æœåŠ¡å™¨è¿›è¡Œè¿æ¥ã€‚å¦‚æœä¸Šæ¸¸æœåŠ¡å™¨å¤„ç†èƒ½åŠ›ä¸åŒï¼Œå¯ä»¥é€šè¿‡ç»™serveré…ç½®weightæƒé‡æ¥è¯´æ˜ï¼Œè¯¥ç®—æ³•å°†è€ƒè™‘åˆ°ä¸åŒæœåŠ¡å™¨çš„åŠ æƒæœ€å°‘è¿æ¥æ•°ã€‚</p> <h4 id="rr"><a href="#rr" class="header-anchor">#</a> RR</h4> <p><strong>ç®€å•é…ç½®</strong> ï¼Œè¿™é‡Œæˆ‘é…ç½®äº†2å°æœåŠ¡å™¨ï¼Œå½“ç„¶å®é™…ä¸Šæ˜¯ä¸€å°ï¼Œåªæ˜¯ç«¯å£ä¸ä¸€æ ·è€Œå·²ï¼Œè€Œ8081çš„æœåŠ¡å™¨æ˜¯ä¸å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è®¿é—®ä¸åˆ°ï¼Œä½†æ˜¯æˆ‘ä»¬è®¿é—® <code>http://localhost</code> çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä¼šé»˜è®¤è·³è½¬åˆ°<code>http://localhost:8080</code>å…·ä½“æ˜¯å› ä¸ºNginxä¼šè‡ªåŠ¨åˆ¤æ–­æœåŠ¡å™¨çš„çŠ¶æ€ï¼Œå¦‚æœæœåŠ¡å™¨å¤„äºä¸èƒ½è®¿é—®ï¼ˆæœåŠ¡å™¨æŒ‚äº†ï¼‰ï¼Œå°±ä¸ä¼šè·³è½¬åˆ°è¿™å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¹Ÿé¿å…äº†ä¸€å°æœåŠ¡å™¨æŒ‚äº†å½±å“ä½¿ç”¨çš„æƒ…å†µï¼Œç”±äºNginxé»˜è®¤æ˜¯RRç­–ç•¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å…¶ä»–æ›´å¤šçš„è®¾ç½®</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶upstream test {
    server localhost:8080;
    server localhost:8081;
}
server {
    listen       81;
    server_name  localhost;
    client_max_body_size 1024M;
 
    location / {
        proxy_pass http://test;
        proxy_set_header Host $host:$server_port;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>è´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒä»£ç ä¸º</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶upstream test {
    server localhost:8080;
    server localhost:8081;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="æƒé‡"><a href="#æƒé‡" class="header-anchor">#</a> æƒé‡</h4> <p>æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ ä¾‹å¦‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶upstream test {
    server localhost:8080 weight=9;
    server localhost:8081 weight=1;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>é‚£ä¹ˆ10æ¬¡ä¸€èˆ¬åªä¼šæœ‰1æ¬¡ä¼šè®¿é—®åˆ°8081ï¼Œè€Œæœ‰9æ¬¡ä¼šè®¿é—®åˆ°8080</p> <h4 id="ip-hash"><a href="#ip-hash" class="header-anchor">#</a> ip_hash</h4> <p>ä¸Šé¢çš„2ç§æ–¹å¼éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥çš„æ—¶å€™è¯·æ±‚å¯èƒ½åˆ†å‘åˆ°å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºä¸æ˜¯æ— çŠ¶æ€çš„æ—¶å€™ï¼ˆé‡‡ç”¨äº†sessionä¿å­˜æ•°æ®ï¼‰ï¼Œè¿™æ—¶å€™å°±æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¾ˆé—®é¢˜äº†ï¼Œæ¯”å¦‚æŠŠç™»å½•ä¿¡æ¯ä¿å­˜åˆ°äº†sessionä¸­ï¼Œé‚£ä¹ˆè·³è½¬åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™å°±éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¢æˆ·åªè®¿é—®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨iphashäº†ï¼Œiphashçš„æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶upstream test {
    ip_hash;
    server localhost:8080;
    server localhost:8081;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="fair"><a href="#fair" class="header-anchor">#</a> fair</h4> <p>è¿™æ˜¯ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼ŒæŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶upstream backend {
    fair;
    server localhost:8080;
    server localhost:8081;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="url-hash"><a href="#url-hash" class="header-anchor">#</a> url_hash</h4> <p>è¿™æ˜¯ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼ŒæŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ åœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶upstream backend {
    hash $request_uri;
    hash_method crc32;
    server localhost:8080;
    server localhost:8081;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä»¥ä¸Š5ç§è´Ÿè½½å‡è¡¡å„è‡ªé€‚ç”¨ä¸åŒæƒ…å†µä¸‹ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä½¿ç”¨å“ªç§ç­–ç•¥æ¨¡å¼ï¼Œä¸è¿‡fairå’Œurl_hashéœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—æ‰èƒ½ä½¿ç”¨</p> <p><strong>serveræŒ‡ä»¤å¯é€‰å‚æ•°ï¼š</strong></p> <ol><li>weightï¼šè®¾ç½®ä¸€ä¸ªæœåŠ¡å™¨çš„è®¿é—®æƒé‡ï¼Œæ•°å€¼è¶Šé«˜ï¼Œæ”¶åˆ°çš„è¯·æ±‚ä¹Ÿè¶Šå¤šï¼›</li> <li>fail_timeoutï¼šåœ¨è¿™ä¸ªæŒ‡å®šçš„æ—¶é—´å†…æœåŠ¡å™¨å¿…é¡»æä¾›å“åº”ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†ä¼šè¢«æ ‡è®°ä¸ºdownçŠ¶æ€ï¼›</li> <li>max_failsï¼šè®¾ç½®åœ¨fail_timeoutæ—¶é—´ä¹‹å†…å°è¯•å¯¹ä¸€ä¸ªæœåŠ¡å™¨è¿æ¥çš„æœ€å¤§æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ¬¡æ•°ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†ä¼šè¢«æ ‡è®°ä¸ºdown;</li> <li>downï¼šæ ‡è®°ä¸€ä¸ªæœåŠ¡å™¨ä¸å†æ¥å—ä»»ä½•è¯·æ±‚ï¼›</li> <li>backupï¼šä¸€æ—¦å…¶ä»–æœåŠ¡å™¨å®•æœºï¼Œé‚£ä¹ˆæœ‰è¯¥æ ‡è®°çš„æœºå™¨å°†ä¼šæ¥æ”¶è¯·æ±‚ã€‚</li></ol> <p><strong>keepaliveæŒ‡ä»¤ï¼š</strong></p> <p>NginxæœåŠ¡å™¨å°†ä¼šä¸ºæ¯ä¸€ä¸ªworkerè¿›è¡Œä¿æŒåŒä¸Šæ¸¸æœåŠ¡å™¨çš„è¿æ¥ã€‚</p> <h3 id="å±è”½ip"><a href="#å±è”½ip" class="header-anchor">#</a> å±è”½ip</h3> <p>åœ¨nginxçš„é…ç½®æ–‡ä»¶<code>nginx.conf</code>ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼Œå¯ä»¥æ”¾åˆ°http, server, location, limit_exceptè¯­å¥å—ï¼Œéœ€è¦æ³¨æ„ç›¸å¯¹è·¯å¾„ï¼Œæœ¬ä¾‹å½“ä¸­<code>nginx.conf</code>ï¼Œ<code>blocksip.conf</code>åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶include blockip.conf;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>åœ¨blockip.confé‡Œé¢è¾“å…¥å†…å®¹ï¼Œå¦‚ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶deny 165.91.122.67;

deny IP;   # å±è”½å•ä¸ªipè®¿é—®
allow IP;  # å…è®¸å•ä¸ªipè®¿é—®
deny all;  # å±è”½æ‰€æœ‰ipè®¿é—®
allow all; # å…è®¸æ‰€æœ‰ipè®¿é—®
deny 123.0.0.0/8   # å±è”½æ•´ä¸ªæ®µå³ä»123.0.0.1åˆ°123.255.255.254è®¿é—®çš„å‘½ä»¤
deny 124.45.0.0/16 # å±è”½IPæ®µå³ä»123.45.0.1åˆ°123.45.255.254è®¿é—®çš„å‘½ä»¤
deny 123.45.6.0/24 # å±è”½IPæ®µå³ä»123.45.6.1åˆ°123.45.6.254è®¿é—®çš„å‘½ä»¤

# å¦‚æœä½ æƒ³å®ç°è¿™æ ·çš„åº”ç”¨ï¼Œé™¤äº†å‡ ä¸ªIPå¤–ï¼Œå…¶ä»–å…¨éƒ¨æ‹’ç»
allow 1.1.1.1; 
allow 1.1.1.2;
deny all;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•"><a href="#ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•" class="header-anchor">#</a> ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…æ–¹æ³•</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶./configure --prefix=/ä½ çš„å®‰è£…ç›®å½•  --add-module=/ç¬¬ä¸‰æ–¹æ¨¡å—ç›®å½•
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="header-anchor">#</a> é‡å®šå‘</h2> <ul><li><code>permanent</code> æ°¸ä¹…æ€§é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º301</li> <li><code>redirect</code> ä¸´æ—¶é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º302</li></ul> <h3 id="é‡å®šå‘æ•´ä¸ªç½‘ç«™"><a href="#é‡å®šå‘æ•´ä¸ªç½‘ç«™" class="header-anchor">#</a> é‡å®šå‘æ•´ä¸ªç½‘ç«™</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶server {
    server_name old-site.com
    return 301 $scheme://new-site.com$request_uri;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="é‡å®šå‘å•é¡µ"><a href="#é‡å®šå‘å•é¡µ" class="header-anchor">#</a> é‡å®šå‘å•é¡µ</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶server {
    location = /oldpage.html {
        return 301 http://example.org/newpage.html;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="é‡å®šå‘æ•´ä¸ªå­è·¯å¾„"><a href="#é‡å®šå‘æ•´ä¸ªå­è·¯å¾„" class="header-anchor">#</a> é‡å®šå‘æ•´ä¸ªå­è·¯å¾„</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶location /old-site {
    rewrite ^/old-site/(.*) http://example.org/new-site/$1 permanent;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="æ€§èƒ½"><a href="#æ€§èƒ½" class="header-anchor">#</a> æ€§èƒ½</h2> <h3 id="å†…å®¹ç¼“å­˜"><a href="#å†…å®¹ç¼“å­˜" class="header-anchor">#</a> å†…å®¹ç¼“å­˜</h3> <p>å…è®¸æµè§ˆå™¨åŸºæœ¬ä¸Šæ°¸ä¹…åœ°ç¼“å­˜é™æ€å†…å®¹ã€‚ Nginxå°†ä¸ºæ‚¨è®¾ç½®Expireså’ŒCache-Controlå¤´ä¿¡æ¯ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶location /static {
    root /data;
    expires max;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å¦‚æœè¦æ±‚æµè§ˆå™¨æ°¸è¿œä¸ä¼šç¼“å­˜å“åº”ï¼ˆä¾‹å¦‚ç”¨äºè·Ÿè¸ªè¯·æ±‚ï¼‰ï¼Œè¯·ä½¿ç”¨-1ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶location = /empty.gif {
    empty_gif;
    expires -1;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="gzipå‹ç¼©"><a href="#gzipå‹ç¼©" class="header-anchor">#</a> Gzipå‹ç¼©</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶gzip  on;
gzip_buffers 16 8k;
gzip_comp_level 6;
gzip_http_version 1.1;
gzip_min_length 256;
gzip_proxied any;
gzip_vary on;
gzip_types
    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml
    text/javascript application/javascript application/x-javascript
    text/x-json application/json application/x-web-app-manifest+json
    text/css text/plain text/x-component
    font/opentype application/x-font-ttf application/vnd.ms-fontobject
    image/x-icon;
gzip_disable  &quot;msie6&quot;;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="æ‰“å¼€æ–‡ä»¶ç¼“å­˜"><a href="#æ‰“å¼€æ–‡ä»¶ç¼“å­˜" class="header-anchor">#</a> æ‰“å¼€æ–‡ä»¶ç¼“å­˜</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶open_file_cache max=1000 inactive=20s;
open_file_cache_valid 30s;
open_file_cache_min_uses 2;
open_file_cache_errors on;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="sslç¼“å­˜"><a href="#sslç¼“å­˜" class="header-anchor">#</a> SSLç¼“å­˜</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="ä¸Šæ¸¸keepalive"><a href="#ä¸Šæ¸¸keepalive" class="header-anchor">#</a> ä¸Šæ¸¸Keepalive</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶upstream backend {
    server 127.0.0.1:8080;
    keepalive 32;
}
server {
    ...
    location /api/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Connection &quot;&quot;;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="ç›‘æ§"><a href="#ç›‘æ§" class="header-anchor">#</a> ç›‘æ§</h3> <p>ä½¿ç”¨<code>ngxtop</code>å®æ—¶è§£ænginxè®¿é—®æ—¥å¿—ï¼Œå¹¶ä¸”å°†å¤„ç†ç»“æœè¾“å‡ºåˆ°ç»ˆç«¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç³»ç»Ÿå‘½ä»¤topã€‚æ‰€æœ‰ç¤ºä¾‹éƒ½è¯»å–nginxé…ç½®æ–‡ä»¶çš„è®¿é—®æ—¥å¿—ä½ç½®å’Œæ ¼å¼ã€‚å¦‚æœè¦æŒ‡å®šè®¿é—®æ—¥å¿—æ–‡ä»¶å’Œ/æˆ–æ—¥å¿—æ ¼å¼ï¼Œè¯·ä½¿ç”¨-få’Œ-aé€‰é¡¹ã€‚</p> <p>æ³¨æ„ï¼šåœ¨nginxé…ç½®ä¸­<code>/usr/local/nginx/conf/nginx.conf</code>æ—¥å¿—æ–‡ä»¶å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶# å®‰è£… ngxtop
pip install ngxtop

# å®æ—¶çŠ¶æ€
ngxtop
# çŠ¶æ€ä¸º404çš„å‰10ä¸ªè¯·æ±‚çš„è·¯å¾„ï¼š
ngxtop top request_path --filter 'status == 404'

# å‘é€æ€»å­—èŠ‚æ•°æœ€å¤šçš„å‰10ä¸ªè¯·æ±‚
ngxtop --order-by 'avg(bytes_sent) * count'

# æ’åå‰åä½çš„IPï¼Œä¾‹å¦‚ï¼Œè°æ”»å‡»ä½ æœ€å¤š
ngxtop --group-by remote_addr

# æ‰“å°å…·æœ‰4xxæˆ–5xxçŠ¶æ€çš„è¯·æ±‚ï¼Œä»¥åŠstatuså’Œhttp referer
ngxtop -i 'status &gt;= 400' print request status http_referer

# ç”±200ä¸ªè¯·æ±‚è·¯å¾„å“åº”å‘é€çš„å¹³å‡æ­£æ–‡å­—èŠ‚ä»¥'foo'å¼€å§‹ï¼š
ngxtop avg bytes_sent --filter 'status == 200 and request_path.startswith(&quot;foo&quot;)'

# ä½¿ç”¨â€œcommonâ€æ—¥å¿—æ ¼å¼ä»è¿œç¨‹æœºå™¨åˆ†æapacheè®¿é—®æ—¥å¿—
ssh remote tail -f /var/log/apache2/access.log | ngxtop -f common
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="å¸¸è§ä½¿ç”¨åœºæ™¯"><a href="#å¸¸è§ä½¿ç”¨åœºæ™¯" class="header-anchor">#</a> å¸¸è§ä½¿ç”¨åœºæ™¯</h2> <h3 id="è·¨åŸŸé—®é¢˜"><a href="#è·¨åŸŸé—®é¢˜" class="header-anchor">#</a> è·¨åŸŸé—®é¢˜</h3> <p>åœ¨å·¥ä½œä¸­ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°ä¸€äº›æ¥å£ä¸æ”¯æŒè·¨åŸŸï¼Œè¿™æ—¶å€™å¯ä»¥ç®€å•çš„æ·»åŠ add_headersæ¥æ”¯æŒcorsè·¨åŸŸã€‚é…ç½®å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶server {
  listen 80;
  server_name api.xxx.com;
    
  add_header 'Access-Control-Allow-Origin' '*';
  add_header 'Access-Control-Allow-Credentials' 'true';
  add_header 'Access-Control-Allow-Methods' 'GET,POST,HEAD';

  location / {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host  $http_host;    
  } 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ä¸Šé¢æ›´æ”¹å¤´ä¿¡æ¯ï¼Œè¿˜æœ‰ä¸€ç§ï¼Œä½¿ç”¨ <a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html" target="_blank" rel="noopener noreferrer">rewrite<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æŒ‡ä»¤é‡å®šå‘URIæ¥è§£å†³è·¨åŸŸé—®é¢˜ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶upstream test {
  server 127.0.0.1:8080;
  server localhost:8081;
}
server {
  listen 80;
  server_name api.xxx.com;
  location / { 
    root  html;                   #å»è¯·æ±‚../htmlæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶
    index  index.html index.htm;  #é¦–é¡µå“åº”åœ°å€
  }
  # ç”¨äºæ‹¦æˆªè¯·æ±‚ï¼ŒåŒ¹é…ä»»ä½•ä»¥ /api/å¼€å¤´çš„åœ°å€ï¼Œ
  # åŒ¹é…ç¬¦åˆä»¥åï¼Œåœæ­¢å¾€ä¸‹æœç´¢æ­£åˆ™ã€‚
  location ^~/api/{ 
    # ä»£è¡¨é‡å†™æ‹¦æˆªè¿›æ¥çš„è¯·æ±‚ï¼Œå¹¶ä¸”åªèƒ½å¯¹åŸŸååè¾¹çš„é™¤å»ä¼ é€’çš„å‚æ•°å¤–çš„å­—ç¬¦ä¸²èµ·ä½œç”¨ï¼Œ
    # ä¾‹å¦‚www.a.com/proxy/api/msg?meth=1&amp;par=2é‡å†™ï¼Œåªå¯¹/proxy/api/msgé‡å†™ã€‚
    # rewriteåé¢çš„å‚æ•°æ˜¯ä¸€ä¸ªç®€å•çš„æ­£åˆ™ ^/api/(.*)$ï¼Œ
    # $1ä»£è¡¨æ­£åˆ™ä¸­çš„ç¬¬ä¸€ä¸ª()ï¼Œ$2ä»£è¡¨ç¬¬äºŒä¸ª()çš„å€¼ï¼Œä»¥æ­¤ç±»æ¨ã€‚
    rewrite ^/api/(.*)$ /$1 break;
    
    # æŠŠè¯·æ±‚ä»£ç†åˆ°å…¶ä»–ä¸»æœº 
    # å…¶ä¸­ http://www.b.com/ å†™æ³•å’Œ http://www.b.comå†™æ³•çš„åŒºåˆ«å¦‚ä¸‹
    # å¦‚æœä½ çš„è¯·æ±‚åœ°å€æ˜¯ä»– http://server/html/test.jsp
    # é…ç½®ä¸€ï¼š http://www.b.com/ åé¢æœ‰â€œ/â€ 
    #         å°†åå‘ä»£ç†æˆ http://www.b.com/html/test.jsp è®¿é—®
    # é…ç½®ä¸€ï¼š http://www.b.com åé¢æ²¡æœ‰æœ‰â€œ/â€ 
    #         å°†åå‘ä»£ç†æˆ http://www.b.com/test.jsp è®¿é—®
    proxy_pass http://test;

    # å¦‚æœ proxy_pass  URL æ˜¯ http://a.xx.com/platform/ è¿™ç§æƒ…å†µ
    # proxy_cookie_pathåº”è¯¥è®¾ç½®æˆ /platform/ / (æ³¨æ„ä¸¤ä¸ªæ–œæ ä¹‹é—´æœ‰ç©ºæ ¼)ã€‚
    proxy_cookie_path /platfrom/ /;

    # http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header
    # è®¾ç½® Cookie å¤´é€šè¿‡
    proxy_pass_header Set-Cookie;
  } 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢"><a href="#è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢" class="header-anchor">#</a> è·³è½¬åˆ°å¸¦wwwçš„åŸŸä¸Šé¢</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶server {
    listen 80;
    # é…ç½®æ­£å¸¸çš„å¸¦wwwçš„åŸŸå
    server_name www.wangchujiang.com;
    root /home/www/wabg/download;
    location / {
        try_files $uri $uri/ /index.html =404;
    }
}
server {
    # è¿™ä¸ªè¦æ”¾åˆ°ä¸‹é¢ï¼Œ
    # å°†ä¸å¸¦wwwçš„ wangchujiang.com æ°¸ä¹…æ€§é‡å®šå‘åˆ°  https://www.wangchujiang.com
    server_name wangchujiang.com;
    rewrite ^(.*) https://www.wangchujiang.com$1 permanent;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="ä»£ç†è½¬å‘"><a href="#ä»£ç†è½¬å‘" class="header-anchor">#</a> ä»£ç†è½¬å‘</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶upstream server-api{
    # api ä»£ç†æœåŠ¡åœ°å€
    server 127.0.0.1:3110;    
}
upstream server-resource{
    # é™æ€èµ„æº ä»£ç†æœåŠ¡åœ°å€
    server 127.0.0.1:3120;
}
server {
    listen       3111;
    server_name  localhost;      # è¿™é‡ŒæŒ‡å®šåŸŸå
    root /home/www/server-statics;
    # åŒ¹é… api è·¯ç”±çš„åå‘ä»£ç†åˆ°APIæœåŠ¡
    location ^~/api/ {
        rewrite ^/(.*)$ /$1 break;
        proxy_pass http://server-api;
    }
    # å‡è®¾è¿™é‡ŒéªŒè¯ç ä¹Ÿåœ¨APIæœåŠ¡ä¸­
    location ^~/captcha {
        rewrite ^/(.*)$ /$1 break;
        proxy_pass http://server-api;
    }
    # å‡è®¾ä½ çš„å›¾ç‰‡èµ„æºå…¨éƒ¨åœ¨å¦å¤–ä¸€ä¸ªæœåŠ¡ä¸Šé¢
    location ^~/img/ {
        rewrite ^/(.*)$ /$1 break;
        proxy_pass http://server-resource;
    }
    # è·¯ç”±åœ¨å‰ç«¯ï¼Œåç«¯æ²¡æœ‰çœŸå®è·¯ç”±ï¼Œåœ¨è·¯ç”±ä¸å­˜åœ¨çš„ 404çŠ¶æ€çš„é¡µé¢è¿”å› /index.html
    # è¿™ä¸ªæ–¹å¼ä½¿ç”¨åœºæ™¯ï¼Œä½ åœ¨å†™Reactæˆ–è€…Vueé¡¹ç›®çš„æ—¶å€™ï¼Œæ²¡æœ‰çœŸå®è·¯ç”±
    location / {
        try_files $uri $uri/ /index.html =404;
        #                               ^ ç©ºæ ¼å¾ˆé‡è¦
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="ç›‘æ§çŠ¶æ€ä¿¡æ¯"><a href="#ç›‘æ§çŠ¶æ€ä¿¡æ¯" class="header-anchor">#</a> ç›‘æ§çŠ¶æ€ä¿¡æ¯</h3> <p>é€šè¿‡ <code>nginx -V</code> æ¥æŸ¥çœ‹æ˜¯å¦æœ‰ <code>with-http_stub_status_module</code> è¯¥æ¨¡å—ã€‚</p> <blockquote><p><code>nginx -V</code> è¿™é‡Œ <code>V</code> æ˜¯å¤§å†™çš„ï¼Œå¦‚æœæ˜¯å°å†™çš„ <code>v</code> å³ <code>nginx -v</code>ï¼Œåˆ™ä¸ä¼šå‡ºç°æœ‰å“ªäº›æ¨¡å—ï¼Œåªä¼šå‡ºç° <code>nginx</code> çš„ç‰ˆæœ¬</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶location /nginx_status {
    stub_status on;
    access_log off;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>é€šè¿‡ http://127.0.0.1/nginx_status è®¿é—®å‡ºç°ä¸‹é¢ç»“æœã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶Active connections: 3
server accepts handled requests
 7 7 5 
Reading: 0 Writing: 1 Waiting: 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol><li>ä¸»åŠ¨è¿æ¥(ç¬¬ 1 è¡Œ)</li></ol> <p>å½“å‰ä¸httpå»ºç«‹çš„è¿æ¥æ•°ï¼ŒåŒ…æ‹¬ç­‰å¾…çš„å®¢æˆ·ç«¯è¿æ¥ï¼š3</p> <ol><li>æœåŠ¡å™¨æ¥å—å¤„ç†çš„è¯·æ±‚(ç¬¬ 2~3 è¡Œ)</li></ol> <p>æ¥å—çš„å®¢æˆ·ç«¯è¿æ¥æ€»æ•°ç›®ï¼š7
å¤„ç†çš„å®¢æˆ·ç«¯è¿æ¥æ€»æ•°ç›®ï¼š7
å®¢æˆ·ç«¯æ€»çš„è¯·æ±‚æ•°ç›®ï¼š5</p> <ol><li>è¯»å–å…¶å®ƒä¿¡(ç¬¬ 4 è¡Œ)</li></ol> <p>å½“å‰ï¼Œnginxè¯»è¯·æ±‚è¿æ¥
å½“å‰ï¼Œnginxå†™å“åº”è¿”å›ç»™å®¢æˆ·ç«¯
ç›®å‰æœ‰å¤šå°‘ç©ºé—²å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥</p> <h3 id="ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢"><a href="#ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢" class="header-anchor">#</a> ä»£ç†è½¬å‘è¿æ¥æ›¿æ¢</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶location ^~/api/upload {
    rewrite ^/(.*)$ /wfs/v1/upload break;
    proxy_pass http://wfs-api;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="sslé…ç½®"><a href="#sslé…ç½®" class="header-anchor">#</a> sslé…ç½®</h3> <p>è¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®ï¼ˆç¼©å†™ï¼šHTTPSï¼Œè‹±è¯­ï¼šHypertext Transfer Protocol Secureï¼‰æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®å’ŒSSL/TLSçš„ç»„åˆï¼Œç”¨ä»¥æä¾›åŠ å¯†é€šè®¯åŠå¯¹ç½‘ç»œæœåŠ¡å™¨èº«ä»½çš„é‰´å®šã€‚HTTPSè¿æ¥ç»å¸¸è¢«ç”¨äºä¸‡ç»´ç½‘ä¸Šçš„äº¤æ˜“æ”¯ä»˜å’Œä¼ä¸šä¿¡æ¯ç³»ç»Ÿä¸­æ•æ„Ÿä¿¡æ¯çš„ä¼ è¾“ã€‚HTTPSä¸åº”ä¸åœ¨RFC 2660ä¸­å®šä¹‰çš„å®‰å…¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆS-HTTPï¼‰ç›¸æ··ã€‚HTTPS ç›®å‰å·²ç»æ˜¯æ‰€æœ‰æ³¨é‡éšç§å’Œå®‰å…¨çš„ç½‘ç«™çš„é¦–é€‰ï¼Œéšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒHTTPS ç½‘ç«™å·²ä¸å†æ˜¯å¤§å‹ç½‘ç«™çš„ä¸“åˆ©ï¼Œæ‰€æœ‰æ™®é€šçš„ä¸ªäººç«™é•¿å’Œåšå®¢å‡å¯ä»¥è‡ªå·±åŠ¨æ‰‹æ­å»ºä¸€ä¸ªå®‰å…¨çš„åŠ å¯†çš„ç½‘ç«™ã€‚</p> <p>åˆ›å»ºSSLè¯ä¹¦ï¼Œå¦‚æœä½ è´­ä¹°çš„è¯ä¹¦ï¼Œå°±å¯ä»¥ç›´æ¥ä¸‹è½½</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶sudo mkdir /etc/nginx/ssl
# åˆ›å»ºäº†æœ‰æ•ˆæœŸ100å¹´ï¼ŒåŠ å¯†å¼ºåº¦ä¸ºRSA2048çš„SSLå¯†é’¥keyå’ŒX509è¯ä¹¦æ–‡ä»¶ã€‚
sudo openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt
# ä¸Šé¢å‘½ä»¤ï¼Œä¼šæœ‰ä¸‹é¢éœ€è¦å¡«å†™å†…å®¹
Country Name (2 letter code) [AU]:US
State or Province Name (full name) [Some-State]:New York
Locality Name (eg, city) []:New York City
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Bouncy Castles, Inc.
Organizational Unit Name (eg, section) []:Ministry of Water Slides
Common Name (e.g. server FQDN or YOUR name) []:your_domain.com
Email Address []:admin@your_domain.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>åˆ›å»ºè‡ªç­¾è¯ä¹¦</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶é¦–å…ˆï¼Œåˆ›å»ºè¯ä¹¦å’Œç§é’¥çš„ç›®å½•
# mkdir -p /etc/nginx/cert
# cd /etc/nginx/cert
åˆ›å»ºæœåŠ¡å™¨ç§é’¥ï¼Œå‘½ä»¤ä¼šè®©ä½ è¾“å…¥ä¸€ä¸ªå£ä»¤ï¼š
# openssl genrsa -des3 -out nginx.key 2048
åˆ›å»ºç­¾åè¯·æ±‚çš„è¯ä¹¦ï¼ˆCSRï¼‰ï¼š
# openssl req -new -key nginx.key -out nginx.csr
åœ¨åŠ è½½SSLæ”¯æŒçš„Nginxå¹¶ä½¿ç”¨ä¸Šè¿°ç§é’¥æ—¶é™¤å»å¿…é¡»çš„å£ä»¤ï¼š
# cp nginx.key nginx.key.org
# openssl rsa -in nginx.key.org -out nginx.key
æœ€åæ ‡è®°è¯ä¹¦ä½¿ç”¨ä¸Šè¿°ç§é’¥å’ŒCSRï¼š
# openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>æŸ¥çœ‹ç›®å‰nginxç¼–è¯‘é€‰é¡¹</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶sbin/nginx -V
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¾“å‡ºä¸‹é¢å†…å®¹</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶nginx version: nginx/1.7.8
built by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)
TLS SNI support enabled
configure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å¦‚æœä¾èµ–çš„æ¨¡å—ä¸å­˜åœ¨ï¼Œå¯ä»¥è¿›å…¥å®‰è£…ç›®å½•ï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤é‡æ–°ç¼–è¯‘å®‰è£…ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¿è¡Œå®Œæˆä¹‹åè¿˜éœ€è¦<code>make</code> (ä¸ç”¨make install)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶# å¤‡ä»½nginxçš„äºŒè¿›åˆ¶æ–‡ä»¶
cp -rf /usr/local/nginx/sbin/nginxã€€ /usr/local/nginx/sbin/nginx.bak
# è¦†ç›–nginxçš„äºŒè¿›åˆ¶æ–‡ä»¶
cp -rf objs/nginx   /usr/local/nginx/sbin/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>HTTPS server</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶server {
    listen       443 ssl;
    server_name  localhost;

    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;
    # ç¦æ­¢åœ¨headerä¸­å‡ºç°æœåŠ¡å™¨ç‰ˆæœ¬ï¼Œé˜²æ­¢é»‘å®¢åˆ©ç”¨ç‰ˆæœ¬æ¼æ´æ”»å‡»
    server_tokens off;
    # è®¾ç½®ssl/tlsä¼šè¯ç¼“å­˜çš„ç±»å‹å’Œå¤§å°ã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªå‚æ•°ä¸€èˆ¬æ˜¯sharedï¼Œbuildinå¯èƒ½ä¼šå‚æ•°å†…å­˜ç¢ç‰‡ï¼Œé»˜è®¤æ˜¯noneï¼Œå’Œoffå·®ä¸å¤šï¼Œåœç”¨ç¼“å­˜ã€‚å¦‚shared:SSL:10mè¡¨ç¤ºæˆ‘æ‰€æœ‰çš„nginxå·¥ä½œè¿›ç¨‹å…±äº«sslä¼šè¯ç¼“å­˜ï¼Œå®˜ç½‘ä»‹ç»è¯´1Må¯ä»¥å­˜æ”¾çº¦4000ä¸ªsessionsã€‚ 
    ssl_session_cache    shared:SSL:1m; 

    # å®¢æˆ·ç«¯å¯ä»¥é‡ç”¨ä¼šè¯ç¼“å­˜ä¸­sslå‚æ•°çš„è¿‡æœŸæ—¶é—´ï¼Œå†…ç½‘ç³»ç»Ÿé»˜è®¤5åˆ†é’Ÿå¤ªçŸ­äº†ï¼Œå¯ä»¥è®¾æˆ30må³30åˆ†é’Ÿç”šè‡³4hã€‚
    ssl_session_timeout  5m; 

    # é€‰æ‹©åŠ å¯†å¥—ä»¶ï¼Œä¸åŒçš„æµè§ˆå™¨æ‰€æ”¯æŒçš„å¥—ä»¶ï¼ˆå’Œé¡ºåºï¼‰å¯èƒ½ä¼šä¸åŒã€‚
    # è¿™é‡ŒæŒ‡å®šçš„æ˜¯OpenSSLåº“èƒ½å¤Ÿè¯†åˆ«çš„å†™æ³•ï¼Œä½ å¯ä»¥é€šè¿‡ openssl -v cipher 'RC4:HIGH:!aNULL:!MD5'ï¼ˆåé¢æ˜¯ä½ æ‰€æŒ‡å®šçš„å¥—ä»¶åŠ å¯†ç®—æ³•ï¼‰ æ¥çœ‹æ‰€æ”¯æŒç®—æ³•ã€‚
    ssl_ciphers  HIGH:!aNULL:!MD5;

    # è®¾ç½®åå•†åŠ å¯†ç®—æ³•æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨æˆ‘ä»¬æœåŠ¡ç«¯çš„åŠ å¯†å¥—ä»¶ï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨çš„åŠ å¯†å¥—ä»¶ã€‚
    ssl_prefer_server_ciphers  on;

    location / {
        root   html;
        index  index.html index.htm;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https"><a href="#å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https" class="header-anchor">#</a> å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶server {
    listen       80;
    server_name  example.com;
    rewrite ^ https://$http_host$request_uri? permanent;    # å¼ºåˆ¶å°†httpé‡å®šå‘åˆ°https
    # åœ¨é”™è¯¯é¡µé¢å’Œâ€œæœåŠ¡å™¨â€å“åº”å¤´å­—æ®µä¸­å¯ç”¨æˆ–ç¦ç”¨å‘å°„nginxç‰ˆæœ¬ã€‚ é˜²æ­¢é»‘å®¢åˆ©ç”¨ç‰ˆæœ¬æ¼æ´æ”»å‡»
    server_tokens off;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº"><a href="#ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº" class="header-anchor">#</a> ä¸¤ä¸ªè™šæ‹Ÿä¸»æœº</h3> <p>çº¯é™æ€-html æ”¯æŒ</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶http {
    server {
        listen          80;
        server_name     www.domain1.com;
        access_log      logs/domain1.access.log main;
        location / {
            index index.html;
            root  /var/www/domain1.com/htdocs;
        }
    }
    server {
        listen          80;
        server_name     www.domain2.com;
        access_log      logs/domain2.access.log main;
        location / {
            index index.html;
            root  /var/www/domain2.com/htdocs;
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®"><a href="#è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®" class="header-anchor">#</a> è™šæ‹Ÿä¸»æœºæ ‡å‡†é…ç½®</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶http {
  server {
    listen          80 default;
    server_name     _ *;
    access_log      logs/default.access.log main;
    location / {
       index index.html;
       root  /var/www/default/htdocs;
    }
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="çˆ¬è™«è¿‡æ»¤"><a href="#çˆ¬è™«è¿‡æ»¤" class="header-anchor">#</a> çˆ¬è™«è¿‡æ»¤</h3> <p>æ ¹æ® <code>User-Agent</code> è¿‡æ»¤è¯·æ±‚ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°±å¯ä»¥è¿‡æ»¤ä¸ç¬¦åˆè¦æ±‚çš„çˆ¬è™«è¯·æ±‚(åˆçº§çˆ¬è™«)ã€‚</p> <blockquote><p><code>~*</code> è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶location / {
    if ($http_user_agent ~* &quot;python|curl|java|wget|httpclient|okhttp&quot;) {
        return 503;
    }
    # æ­£å¸¸å¤„ç†
    # ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="é˜²ç›—é“¾"><a href="#é˜²ç›—é“¾" class="header-anchor">#</a> é˜²ç›—é“¾</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶location ~* \.(gif|jpg|png|swf|flv)$ {
   root html
   valid_referers none blocked *.nginxcn.com;
   if ($invalid_referer) {
     rewrite ^/ www.nginx.cn
     #return 404;
   }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="è™šæ‹Ÿç›®å½•é…ç½®"><a href="#è™šæ‹Ÿç›®å½•é…ç½®" class="header-anchor">#</a> è™šæ‹Ÿç›®å½•é…ç½®</h3> <p>aliasæŒ‡å®šçš„ç›®å½•æ˜¯å‡†ç¡®çš„ï¼Œrootæ˜¯æŒ‡å®šç›®å½•çš„ä¸Šçº§ç›®å½•ï¼Œå¹¶ä¸”è¯¥ä¸Šçº§ç›®å½•è¦å«æœ‰locationæŒ‡å®šåç§°çš„åŒåç›®å½•ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶location /img/ {
    alias /var/www/image/;
}
# è®¿é—®/img/ç›®å½•é‡Œé¢çš„æ–‡ä»¶æ—¶ï¼Œningxä¼šè‡ªåŠ¨å»/var/www/image/ç›®å½•æ‰¾æ–‡ä»¶
location /img/ {
    root /var/www/image;
}
# è®¿é—®/img/ç›®å½•ä¸‹çš„æ–‡ä»¶æ—¶ï¼Œnginxä¼šå»/var/www/image/img/ç›®å½•ä¸‹æ‰¾æ–‡ä»¶ã€‚]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="é˜²ç›—å›¾é…ç½®"><a href="#é˜²ç›—å›¾é…ç½®" class="header-anchor">#</a> é˜²ç›—å›¾é…ç½®</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶location ~ \/public\/(css|js|img)\/.*\.(js|css|gif|jpg|jpeg|png|bmp|swf) {
    valid_referers none blocked *.jslite.io;
    if ($invalid_referer) {
        rewrite ^/  http://wangchujiang.com/piratesp.png;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="å±è”½-gitç­‰æ–‡ä»¶"><a href="#å±è”½-gitç­‰æ–‡ä»¶" class="header-anchor">#</a> å±è”½.gitç­‰æ–‡ä»¶</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶location ~ (.git|.gitattributes|.gitignore|.svn) {
    deny all;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®"><a href="#åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®" class="header-anchor">#</a> åŸŸåè·¯å¾„åŠ ä¸åŠ éœ€è¦éƒ½èƒ½æ­£å¸¸è®¿é—®</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶http://wangchujiang.com/api/index.php?a=1&amp;name=wcj
                                  ^ æœ‰åç¼€

http://wangchujiang.com/api/index?a=1&amp;name=wcj
                                 ^ æ²¡æœ‰åç¼€
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>nginx rewriteè§„åˆ™å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶rewrite ^/(.*)/$ /index.php?/$1 permanent;
if (!-d $request_filename){
        set $rule_1 1$rule_1;
}
if (!-f $request_filename){
        set $rule_1 2$rule_1;
}
if ($rule_1 = &quot;21&quot;){
        rewrite ^/ /index.php last;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="é”™è¯¯é—®é¢˜"><a href="#é”™è¯¯é—®é¢˜" class="header-anchor">#</a> é”™è¯¯é—®é¢˜</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶The plain HTTP request was sent to HTTPS port
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è§£å†³åŠæ³•ï¼Œ<code>fastcgi_param HTTPS $https if_not_empty</code> æ·»åŠ è¿™æ¡è§„åˆ™ï¼Œ</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å¤åˆ¶server {
    listen 443 ssl; # æ³¨æ„è¿™æ¡è§„åˆ™
    server_name  my.domain.com;
    
    fastcgi_param HTTPS $https if_not_empty;
    fastcgi_param HTTPS on;

    ssl_certificate /etc/ssl/certs/your.pem;
    ssl_certificate_key /etc/ssl/private/your.key;

    location / {
        # Your config here...
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="nginx-æ¨¡å—"><a href="#nginx-æ¨¡å—" class="header-anchor">#</a> Nginx æ¨¡å—</h2> <ul><li><a href="https://gitlab.com/rbdr/ngx_http_office_hours_filter_module" target="_blank" rel="noopener noreferrer">Nginx Office Hours<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¸€ä¸ª nginx æ¨¡å—ï¼Œå…è®¸æ‚¨ä»…åœ¨åŠå…¬æ—¶é—´å†…æä¾›è®¿é—®è®¿é—®ç½‘ç«™ã€‚</li></ul> <h2 id="ç²¾å“æ–‡ç« å‚è€ƒ"><a href="#ç²¾å“æ–‡ç« å‚è€ƒ" class="header-anchor">#</a> ç²¾å“æ–‡ç« å‚è€ƒ</h2> <ul><li><p><a href="https://my.oschina.net/u/3341316/blog/877206" target="_blank" rel="noopener noreferrer">è´Ÿè½½å‡è¡¡åŸç†çš„è§£æ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://blog.githuber.cn/posts/73" target="_blank" rel="noopener noreferrer">Nginxæ³›åŸŸåè§£æï¼Œå®ç°å¤šä¸ªäºŒçº§åŸŸå<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/" target="_blank" rel="noopener noreferrer">æ·±å…¥ NGINX: æˆ‘ä»¬å¦‚ä½•è®¾è®¡æ€§èƒ½å’Œæ‰©å±•<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/" target="_blank" rel="noopener noreferrer">Inside NGINX: How We Designed for Performance &amp; Scale<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://tengine.taobao.org/book/index.html" target="_blank" rel="noopener noreferrer">Nginxå¼€å‘ä»å…¥é—¨åˆ°ç²¾é€š<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://os.51cto.com/art/201703/535326.htm#topx" target="_blank" rel="noopener noreferrer">Nginxçš„ä¼˜åŒ–ä¸é˜²ç›—é“¾<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://segmentfault.com/a/1190000009769143" target="_blank" rel="noopener noreferrer">å®æˆ˜å¼€å‘ä¸€ä¸ªNginxæ‰©å±• (Nginx Module)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://my.oschina.net/xshuai/blog/917097" target="_blank" rel="noopener noreferrer">Nginx+Keepalived(åŒæœºçƒ­å¤‡)æ­å»ºé«˜å¯ç”¨è´Ÿè½½å‡è¡¡ç¯å¢ƒ(HA)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://www.huxd.org/articles/2017/07/24/1500890692329.html" target="_blank" rel="noopener noreferrer">Nginx å¹³æ»‘å‡çº§<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://mp.weixin.qq.com/s?__biz=MzIxNzg5ODE0OA==&amp;mid=2247483708&amp;idx=1&amp;sn=90b0b1dccd9c337922a0588245277666&amp;chksm=97f38cf7a08405e1928e0b46d923d630e529e7db8ac7ca2a91310a075986f8bcb2cee5b4953d#rd" target="_blank" rel="noopener noreferrer">Nginxæœ€æ–°æ¨¡å—â€”ngx_http_mirror_moduleåˆ†æå¯ä»¥åšç‰ˆæœ¬å‘å¸ƒå‰çš„é¢„å…ˆéªŒè¯ï¼Œè¿›è¡Œæµé‡æ”¾å¤§åçš„å‹æµ‹ç­‰ç­‰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>åŸæ–‡é“¾æ¥https://www.viayc.com/2019/03/13/Nginx%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B/</p></li></ul></div></div> <div class="page-slot page-slot-bottom"><div class="donation">
  <button>æ‰“èµ</button>
  <div class="main">
      <div class="pic">
          <img src="https://i.imgtg.com/2023/03/14/fEKGU.jpg" alt="å¾®ä¿¡">
          <img src="https://i.imgtg.com/2023/03/14/fEAep.jpg" alt="æ”¯ä»˜å®">
      </div>
  </div>
</div></div> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=nginx" title="æ ‡ç­¾">#nginx</a></div> <!----></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/adbe78/" class="prev">windowsåº”ç”¨æœåŠ¡éƒ¨ç½²è„šæœ¬</a></span> <span class="next"><a href="/pages/df9ea8/">nginxå¸¸ç”¨é…ç½®</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/12c5da01/"><div>
            ansibleå…¥é—¨
            <!----></div></a> <span class="date"></span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ef347e/"><div>
            rpmå®‰è£…zabbix proxyè¿‡ç¨‹ç®€è®°
            <!----></div></a> <span class="date">03-02</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/88a4de/"><div>
            éƒ¨ç½²cephé›†ç¾¤ Nautilusç‰ˆ
            <!----></div></a> <span class="date">03-01</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/ziye140030" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="ziye140030@163.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href=" " title="è®¢é˜…" target="_blank" class="iconfont icon-rss"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2021-2023
    <span>| <a href="https://www.foreverblog.cn/" class="d-inline-block text-muted" target="_blank" rel="external nofollow"><img src="/img/964560013b68c2e4.png" alt="ç‚¹å‡»æŸ¥çœ‹åå¹´ä¹‹çº¦" style="width:auto;height:11px;"></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas><!----><div></div><div></div><div></div></div></div>
    <script src="/assets/js/app.47f0cd8e.js" defer></script><script src="/assets/js/2.5530ac35.js" defer></script><script src="/assets/js/90.6088167d.js" defer></script><script src="/assets/js/7.6ac946b2.js" defer></script><script src="/assets/js/4.eef75fb3.js" defer></script>
  </body>
</html>
